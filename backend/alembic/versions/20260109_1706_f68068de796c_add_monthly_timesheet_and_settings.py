"""Add Monthly Timesheet and Settings

Revision ID: f68068de796c
Revises: 2b51fa85ac98
Create Date: 2026-01-09 17:06:57.910171+00:00

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'f68068de796c'
down_revision: Union[str, None] = '2b51fa85ac98'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('hr_reporting_settings',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('timesheet_confirmation_day', sa.Integer(), nullable=False),
    sa.Column('timesheet_confirmation_month_offset', sa.Integer(), nullable=False),
    sa.Column('updated_by', sa.UUID(), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    schema='hr_reporting'
    )
    op.create_table('monthly_timesheets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('employee_id', sa.UUID(), nullable=False),
    sa.Column('year', sa.Integer(), nullable=False),
    sa.Column('month', sa.Integer(), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('days', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('summary', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('confirmed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('confirmed_by', sa.UUID(), nullable=True),
    sa.Column('approved_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('approved_by', sa.UUID(), nullable=True),
    sa.Column('employee_notes', sa.Text(), nullable=True),
    sa.Column('hr_notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    schema='hr_reporting'
    )
    op.create_index(op.f('ix_hr_reporting_monthly_timesheets_employee_id'), 'monthly_timesheets', ['employee_id'], unique=False, schema='hr_reporting')
    op.create_index(op.f('ix_hr_reporting_monthly_timesheets_status'), 'monthly_timesheets', ['status'], unique=False, schema='hr_reporting')
    op.drop_index('ix_leaves_time_ledger_user_id', table_name='time_ledger')
    op.drop_index('ix_time_ledger_reference', table_name='time_ledger')
    op.drop_index('ix_time_ledger_user_year_type', table_name='time_ledger')
    op.drop_table('time_ledger')
    op.drop_table('expense_types')
    op.drop_index('ix_auth_user_roles_user_role', table_name='user_roles', schema='auth')
    op.drop_table('user_roles', schema='auth')
    op.drop_index('ix_approvals_workflow_configs_entity_type', table_name='workflow_configs')
    op.drop_index('ix_approvals_workflow_configs_is_active', table_name='workflow_configs')
    op.drop_table('workflow_configs')
    op.drop_table('roles')
    op.drop_table('wallet_transactions')
    op.drop_index('ix_leaves_leave_requests_start_date', table_name='leave_requests')
    op.drop_index('ix_leaves_leave_requests_status', table_name='leave_requests')
    op.drop_index('ix_leaves_leave_requests_user_id', table_name='leave_requests')
    op.drop_table('leave_requests')
    op.drop_table('executive_levels')
    op.drop_index('ix_hr_alerts_active_severity', table_name='hr_alerts')
    op.drop_index('ix_hr_reporting_hr_alerts_alert_type', table_name='hr_alerts')
    op.drop_index('ix_hr_reporting_hr_alerts_employee_id', table_name='hr_alerts')
    op.drop_index('ix_hr_reporting_hr_alerts_is_active', table_name='hr_alerts')
    op.drop_table('hr_alerts')
    op.drop_table('work_schedules')
    op.drop_table('organizational_services')
    op.drop_index('ix_expenses_business_trips_status', table_name='business_trips')
    op.drop_index('ix_expenses_business_trips_user_id', table_name='business_trips')
    op.drop_table('business_trips')
    op.drop_index('ix_leave_interruptions_type', table_name='leave_interruptions')
    op.drop_index('ix_leaves_leave_interruptions_leave_request_id', table_name='leave_interruptions')
    op.drop_table('leave_interruptions')
    op.drop_index('idx_approval_decisions_pending', table_name='approval_decisions', postgresql_where='(decided_at IS NULL)')
    op.drop_index('ix_approvals_approval_decisions_approver_id', table_name='approval_decisions')
    op.drop_table('approval_decisions')
    op.drop_index('ix_calendar_location_calendars_location_id', table_name='location_calendars')
    op.drop_table('location_calendars')
    op.drop_table('trip_wallet_transactions')
    op.drop_index('ix_config_contract_types_code', table_name='contract_types')
    op.drop_table('contract_types')
    op.drop_index('ix_audit_logs_archive_created', table_name='audit_logs_archive', schema='audit')
    op.drop_table('audit_logs_archive', schema='audit')
    op.drop_index('ix_leaves_balance_transactions_balance', table_name='balance_transactions')
    op.drop_table('balance_transactions')
    op.drop_table('holiday_profiles')
    op.drop_index('ix_approvals_approval_history_approval_request_id', table_name='approval_history')
    op.drop_table('approval_history')
    op.drop_index('ix_time_wallet_employee_wallets_user_id', table_name='employee_wallets')
    op.drop_table('employee_wallets')
    op.drop_index('ix_expense_ledger_reference', table_name='expense_ledger')
    op.drop_index('ix_expense_ledger_trip', table_name='expense_ledger')
    op.drop_index('ix_expenses_expense_ledger_trip_id', table_name='expense_ledger')
    op.drop_index('ix_expenses_expense_ledger_user_id', table_name='expense_ledger')
    op.drop_table('expense_ledger')
    op.drop_index('ix_audit_trail_changed_at', table_name='audit_trail')
    op.drop_index('ix_audit_trail_changed_by', table_name='audit_trail')
    op.drop_index('ix_audit_trail_entity', table_name='audit_trail')
    op.drop_table('audit_trail')
    op.drop_index('ix_training_records_employee_id', table_name='training_records')
    op.drop_index('ix_training_records_expiry_date', table_name='training_records')
    op.drop_index('ix_training_records_status', table_name='training_records')
    op.drop_index('ix_training_records_training_type', table_name='training_records')
    op.drop_table('training_records')
    op.drop_index('ix_audit_logs_admin_query', table_name='audit_logs')
    op.drop_index('ix_audit_logs_created_at', table_name='audit_logs')
    op.drop_index('ix_audit_logs_resource', table_name='audit_logs')
    op.drop_index('ix_audit_logs_user_id', table_name='audit_logs')
    op.drop_table('audit_logs')
    op.drop_index('ix_notifications_push_subscriptions_user_id', table_name='push_subscriptions')
    op.drop_index('ix_push_subscriptions_endpoint', table_name='push_subscriptions')
    op.drop_table('push_subscriptions')
    op.drop_index('ix_calendar_calendars_owner_id', table_name='calendars')
    op.drop_table('calendars')
    op.drop_index('ix_leaves_leave_balances_user_id', table_name='leave_balances', schema='leaves')
    op.drop_index('ix_leaves_leave_balances_user_year', table_name='leave_balances', schema='leaves')
    op.drop_index('ix_leaves_leave_balances_year', table_name='leave_balances', schema='leaves')
    op.drop_table('leave_balances', schema='leaves')
    op.drop_table('email_templates')
    op.drop_index('ix_leaves_time_ledger_user_id', table_name='time_ledger', schema='leaves')
    op.drop_index('ix_time_ledger_reference', table_name='time_ledger', schema='leaves')
    op.drop_index('ix_time_ledger_user_year_type', table_name='time_ledger', schema='leaves')
    op.drop_table('time_ledger', schema='leaves')
    op.drop_table('trip_attachments')
    op.drop_index('ix_leaves_leave_request_history_request', table_name='leave_request_history')
    op.drop_table('leave_request_history')
    op.drop_index('ix_hr_reporting_daily_snapshots_snapshot_date', table_name='daily_snapshots')
    op.drop_table('daily_snapshots')
    op.drop_index('ix_wallet_trip_wallets_trip_id', table_name='trip_wallets', schema='expenses')
    op.drop_index('ix_wallet_trip_wallets_user_id', table_name='trip_wallets', schema='expenses')
    op.drop_table('trip_wallets', schema='expenses')
    op.drop_index('ix_audit_trail_archive_changed', table_name='audit_trail_archive', schema='audit')
    op.drop_table('audit_trail_archive', schema='audit')
    op.drop_index('ix_approvals_approval_reminders_scheduled_at', table_name='approval_reminders')
    op.drop_table('approval_reminders')
    op.drop_table('wallet_transactions', schema='leaves')
    op.drop_index('ix_auth_employee_contracts_user_id', table_name='employee_contracts')
    op.drop_table('employee_contracts')
    op.drop_table('user_areas')
    op.drop_index('ix_calendar_calendar_shares_user_id', table_name='calendar_shares')
    op.drop_table('calendar_shares')
    op.drop_table('alembic_version')
    op.drop_table('locations')
    op.drop_table('trip_wallet_transactions', schema='expenses')
    op.drop_index('ix_nctc_version_id', table_name='national_contract_type_configs')
    op.drop_table('national_contract_type_configs')
    op.drop_index('ix_leaves_balance_transactions_balance', table_name='balance_transactions', schema='leaves')
    op.drop_table('balance_transactions', schema='leaves')
    op.drop_index('ix_generated_reports_period', table_name='generated_reports')
    op.drop_index('ix_hr_reporting_generated_reports_report_type', table_name='generated_reports')
    op.drop_table('generated_reports')
    op.drop_table('report_attachments')
    op.drop_index('ix_notifications_notifications_notification_type', table_name='notifications')
    op.drop_index('ix_notifications_notifications_user_id', table_name='notifications')
    op.drop_table('notifications')
    op.drop_index('ix_email_logs_created_at', table_name='email_logs')
    op.drop_index('ix_notifications_email_logs_message_id', table_name='email_logs')
    op.drop_index('ix_notifications_email_logs_status', table_name='email_logs')
    op.drop_index('ix_notifications_email_logs_template_code', table_name='email_logs')
    op.drop_index('ix_notifications_email_logs_to_email', table_name='email_logs')
    op.drop_index('ix_notifications_email_logs_user_id', table_name='email_logs')
    op.drop_table('email_logs')
    op.drop_index('ix_time_wallet_employee_wallets_user_id', table_name='employee_wallets', schema='leaves')
    op.drop_table('employee_wallets', schema='leaves')
    op.drop_index('ix_expenses_daily_allowances_trip_date', table_name='daily_allowances')
    op.drop_table('daily_allowances')
    op.drop_table('user_notification_preferences')
    op.drop_index('ix_audit_logs_archive_created', table_name='audit_logs_archive')
    op.drop_table('audit_logs_archive')
    op.drop_index('ix_expense_ledger_reference', table_name='expense_ledger', schema='expenses')
    op.drop_index('ix_expense_ledger_trip', table_name='expense_ledger', schema='expenses')
    op.drop_index('ix_expenses_expense_ledger_trip_id', table_name='expense_ledger', schema='expenses')
    op.drop_index('ix_expenses_expense_ledger_user_id', table_name='expense_ledger', schema='expenses')
    op.drop_table('expense_ledger', schema='expenses')
    op.drop_index('ix_employee_monthly_stats_period', table_name='employee_monthly_stats')
    op.drop_index('ix_hr_reporting_employee_monthly_stats_employee_id', table_name='employee_monthly_stats')
    op.drop_table('employee_monthly_stats')
    op.drop_index('ix_signature_signature_transactions_document_id', table_name='signature_transactions', schema='signature')
    op.drop_index('ix_signature_signature_transactions_document_type', table_name='signature_transactions', schema='signature')
    op.drop_index('ix_signature_signature_transactions_user_id', table_name='signature_transactions', schema='signature')
    op.drop_table('signature_transactions', schema='signature')
    op.drop_index('ix_medical_records_employee_id', table_name='medical_records')
    op.drop_index('ix_medical_records_next_visit_date', table_name='medical_records')
    op.drop_table('medical_records')
    op.drop_index('ix_auth_users_email', table_name='users')
    op.drop_index('ix_auth_users_keycloak_id', table_name='users')
    op.drop_table('users')
    op.drop_index('ix_calendar_event_participants_event_id', table_name='event_participants')
    op.drop_index('ix_calendar_event_participants_user_id', table_name='event_participants')
    op.drop_table('event_participants')
    op.drop_index('ix_expenses_expense_reports_status', table_name='expense_reports')
    op.drop_index('ix_expenses_expense_reports_user_id', table_name='expense_reports')
    op.drop_table('expense_reports')
    op.drop_table('calculation_modes')
    op.drop_index('ix_ncl_contract_id', table_name='national_contract_levels')
    op.drop_table('national_contract_levels')
    op.drop_index('ix_balance_reservations_pending', table_name='balance_reservations')
    op.drop_index('ix_leaves_balance_reservations_user_id', table_name='balance_reservations')
    op.drop_table('balance_reservations')
    op.drop_index('ix_wallet_trip_wallets_trip_id', table_name='trip_wallets')
    op.drop_index('ix_wallet_trip_wallets_user_id', table_name='trip_wallets')
    op.drop_table('trip_wallets')
    op.drop_index('ix_expenses_expense_items_report', table_name='expense_items')
    op.drop_table('expense_items')
    op.drop_table('leave_types')
    op.drop_index('ix_safety_compliance_employee_id', table_name='safety_compliance')
    op.drop_index('ix_safety_compliance_is_compliant', table_name='safety_compliance')
    op.drop_table('safety_compliance')
    op.drop_table('areas')
    op.drop_table('permissions')
    op.drop_table('role_permissions')
    op.drop_table('national_contracts')
    op.drop_table('policy_rules')
    op.drop_index('ix_audit_trail_archive_changed', table_name='audit_trail_archive')
    op.drop_table('audit_trail_archive')
    op.drop_table('user_profiles')
    op.drop_table('departments')
    op.drop_index('idx_approval_requests_pending_expires', table_name='approval_requests', postgresql_where="((status)::text = 'PENDING'::text)")
    op.drop_index('ix_approvals_approval_requests_entity_type', table_name='approval_requests')
    op.drop_index('ix_approvals_approval_requests_expires_at', table_name='approval_requests')
    op.drop_index('ix_approvals_approval_requests_requester_id', table_name='approval_requests')
    op.drop_index('ix_approvals_approval_requests_status', table_name='approval_requests')
    op.drop_table('approval_requests')
    op.drop_index('ix_auth_user_roles_user_role', table_name='user_roles')
    op.drop_table('user_roles')
    op.drop_index('ix_calendar_closures_end_date', table_name='closures')
    op.drop_index('ix_calendar_closures_start_date', table_name='closures')
    op.drop_index('ix_calendar_closures_year', table_name='closures')
    op.drop_table('closures')
    op.drop_index('ix_auth_employee_trainings_user_id', table_name='employee_trainings')
    op.drop_table('employee_trainings')
    op.drop_index('ix_approval_delegations_active', table_name='approval_delegations')
    op.drop_index('ix_leaves_approval_delegations_delegate_id', table_name='approval_delegations')
    op.drop_index('ix_leaves_approval_delegations_delegator_id', table_name='approval_delegations')
    op.drop_table('approval_delegations')
    op.drop_table('work_week_profiles')
    op.drop_index('ix_config_closures_dates', table_name='company_closures')
    op.drop_index('ix_config_company_closures_year', table_name='company_closures')
    op.drop_table('company_closures')
    op.drop_table('daily_allowance_rules')
    op.drop_index('ix_config_system_config_key', table_name='system_config')
    op.drop_table('system_config')
    op.drop_index('ix_leaves_leave_balances_user_id', table_name='leave_balances')
    op.drop_index('ix_leaves_leave_balances_user_year', table_name='leave_balances')
    op.drop_index('ix_leaves_leave_balances_year', table_name='leave_balances')
    op.drop_table('leave_balances')
    op.drop_index('ix_calendar_working_day_exceptions_date', table_name='working_day_exceptions')
    op.drop_index('ix_calendar_working_day_exceptions_year', table_name='working_day_exceptions')
    op.drop_table('working_day_exceptions')
    op.drop_index('ix_config_national_contract_versions_national_contract_id', table_name='national_contract_versions')
    op.drop_index('ix_ncv_contract_valid_from', table_name='national_contract_versions')
    op.drop_table('national_contract_versions')
    op.drop_index('ix_config_holidays_date_location', table_name='holidays')
    op.drop_index('ix_config_holidays_year', table_name='holidays')
    op.drop_index('ix_holidays_year_type', table_name='holidays')
    op.drop_table('holidays')
    op.drop_index('ix_calendar_events_calendar_id', table_name='events')
    op.drop_index('ix_calendar_events_start_date', table_name='events')
    op.drop_index('ix_calendar_events_user_id', table_name='events')
    op.drop_table('events')
    op.drop_index('ix_email_provider_settings_provider_active', table_name='email_provider_settings')
    op.drop_table('email_provider_settings')
    op.drop_table('location_subscriptions')
    op.alter_column('approval_decisions', 'approval_level',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('1'),
               schema='approvals')
    op.alter_column('approval_decisions', 'assigned_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.drop_index('idx_approval_decisions_pending', table_name='approval_decisions', schema='approvals', postgresql_where='(decided_at IS NULL)')
    op.drop_constraint('uq_approver_request', 'approval_decisions', schema='approvals', type_='unique')
    op.alter_column('approval_history', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.alter_column('approval_reminders', 'is_sent',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('approval_requests', 'received_approvals',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='approvals')
    op.alter_column('approval_requests', 'received_rejections',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='approvals')
    op.alter_column('approval_requests', 'current_level',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('1'),
               schema='approvals')
    op.alter_column('approval_requests', 'max_level',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('1'),
               schema='approvals')
    op.alter_column('approval_requests', 'expired_action_taken',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('approval_requests', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.alter_column('approval_requests', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.drop_index('idx_approval_requests_pending_expires', table_name='approval_requests', schema='approvals', postgresql_where="((status)::text = 'PENDING'::text)")
    op.drop_constraint('uq_entity_request', 'approval_requests', schema='approvals', type_='unique')
    op.alter_column('workflow_configs', 'auto_assign_approvers',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('workflow_configs', 'allow_self_approval',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('workflow_configs', 'send_reminders',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'),
               schema='approvals')
    op.alter_column('workflow_configs', 'is_active',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'),
               schema='approvals')
    op.alter_column('workflow_configs', 'is_default',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('workflow_configs', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.alter_column('workflow_configs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.drop_constraint('uq_workflow_entity_name', 'workflow_configs', schema='approvals', type_='unique')
    op.drop_index('ix_audit_logs_admin_query', table_name='audit_logs', schema='audit')
    op.drop_index('ix_audit_logs_created_at', table_name='audit_logs', schema='audit')
    op.drop_index('ix_audit_logs_resource', table_name='audit_logs', schema='audit')
    op.drop_index('ix_audit_logs_user_id', table_name='audit_logs', schema='audit')
    op.drop_index('ix_audit_trail_changed_at', table_name='audit_trail', schema='audit')
    op.drop_index('ix_audit_trail_changed_by', table_name='audit_trail', schema='audit')
    op.drop_index('ix_audit_trail_entity', table_name='audit_trail', schema='audit')
    op.drop_constraint('fk_employee_contracts_level', 'employee_contracts', schema='auth', type_='foreignkey')
    op.drop_constraint('fk_employee_contracts_national_contract', 'employee_contracts', schema='auth', type_='foreignkey')
    op.create_foreign_key(None, 'employee_contracts', 'national_contracts', ['national_contract_id'], ['id'], source_schema='auth', referent_schema='config')
    op.create_foreign_key(None, 'employee_contracts', 'contract_types', ['contract_type_id'], ['id'], source_schema='auth', referent_schema='config')
    op.create_foreign_key(None, 'employee_contracts', 'national_contract_levels', ['level_id'], ['id'], source_schema='auth', referent_schema='config')
    op.alter_column('permissions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='auth')
    op.alter_column('role_permissions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='auth')
    op.alter_column('roles', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='auth')
    op.alter_column('roles', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='auth')
    op.alter_column('users', 'keycloak_id',
               existing_type=sa.VARCHAR(length=255),
               type_=sa.String(length=50),
               existing_nullable=False,
               schema='auth')
    op.drop_index('ix_auth_users_email', table_name='users', schema='auth')
    op.drop_index('ix_auth_users_keycloak_id', table_name='users', schema='auth')
    op.create_unique_constraint(None, 'users', ['fiscal_code'], schema='auth')
    op.create_unique_constraint(None, 'users', ['badge_number'], schema='auth')
    op.create_unique_constraint(None, 'users', ['keycloak_id'], schema='auth')
    op.create_unique_constraint(None, 'users', ['email'], schema='auth')
    op.drop_constraint('users_contract_type_id_fkey', 'users', schema='auth', type_='foreignkey')
    op.drop_constraint('users_manager_id_fkey', 'users', schema='auth', type_='foreignkey')
    op.create_foreign_key(None, 'users', 'contract_types', ['contract_type_id'], ['id'], source_schema='auth', referent_schema='config')
    op.create_foreign_key(None, 'users', 'users', ['manager_id'], ['id'], source_schema='auth', referent_schema='auth')
    op.alter_column('calendar_shares', 'permission',
               existing_type=postgresql.ENUM('READ', 'WRITE', 'ADMIN', name='calendarpermission'),
               type_=sa.Enum('READ', 'WRITE', 'ADMIN', name='calendarpermission', native_enum=False),
               existing_nullable=False,
               existing_server_default=sa.text("'READ'::calendarpermission"),
               schema='calendar')
    op.alter_column('calendars', 'type',
               existing_type=postgresql.ENUM('SYSTEM', 'LOCATION', 'PERSONAL', 'TEAM', name='calendartype'),
               type_=sa.Enum('SYSTEM', 'LOCATION', 'PERSONAL', 'TEAM', name='calendartype', native_enum=False),
               existing_nullable=False,
               schema='calendar')
    op.drop_index('ix_calendar_closures_end_date', table_name='closures', schema='calendar')
    op.drop_index('ix_calendar_closures_start_date', table_name='closures', schema='calendar')
    op.drop_index('ix_calendar_closures_year', table_name='closures', schema='calendar')
    op.drop_column('closures', 'year', schema='calendar')
    op.drop_column('closures', 'updated_at', schema='calendar')
    op.drop_column('closures', 'is_paid', schema='calendar')
    op.drop_column('closures', 'affected_departments', schema='calendar')
    op.drop_column('closures', 'closure_type', schema='calendar')
    op.drop_column('closures', 'created_by', schema='calendar')
    op.drop_column('closures', 'is_active', schema='calendar')
    op.drop_column('closures', 'leave_type_code', schema='calendar')
    op.drop_column('closures', 'affected_locations', schema='calendar')
    op.drop_column('closures', 'description', schema='calendar')
    op.drop_column('closures', 'consumes_leave_balance', schema='calendar')
    op.drop_index('ix_calendar_event_participants_event_id', table_name='event_participants', schema='calendar')
    op.drop_index('ix_calendar_event_participants_user_id', table_name='event_participants', schema='calendar')
    op.drop_column('event_participants', 'is_optional', schema='calendar')
    op.drop_column('event_participants', 'responded_at', schema='calendar')
    op.alter_column('events', 'calendar_id',
               existing_type=sa.UUID(),
               nullable=False,
               schema='calendar')
    op.drop_index('ix_calendar_events_user_id', table_name='events', schema='calendar')
    op.alter_column('holidays', 'date',
               existing_type=sa.DATE(),
               nullable=True,
               schema='calendar')
    op.drop_index('ix_calendar_working_day_exceptions_year', table_name='working_day_exceptions', schema='calendar')
    op.drop_column('working_day_exceptions', 'year', schema='calendar')
    op.drop_column('working_day_exceptions', 'created_by', schema='calendar')
    op.drop_column('working_day_exceptions', 'department_code', schema='calendar')
    op.alter_column('calculation_modes', 'default_parameters',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               nullable=False,
               schema='config')
    op.drop_index('ix_config_closures_dates', table_name='company_closures', schema='config')
    op.drop_index('ix_config_company_closures_year', table_name='company_closures', schema='config')
    op.drop_table_comment(
        'company_closures',
        existing_comment='DEPRECATED: Data migrated to calendar.closures. Use Calendar Service for all closure operations.',
        schema='config'
    )
    op.alter_column('contract_types', 'description',
               existing_type=sa.VARCHAR(length=255),
               type_=sa.String(length=200),
               existing_nullable=True,
               schema='config')
    op.drop_index('ix_config_contract_types_code', table_name='contract_types', schema='config')
    op.create_unique_constraint(None, 'contract_types', ['code'], schema='config')
    op.drop_constraint('fk_contract_types_national_contract', 'contract_types', schema='config', type_='foreignkey')
    op.drop_column('contract_types', 'national_contract_id', schema='config')
    op.alter_column('expense_types', 'code',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.String(length=10),
               existing_nullable=False,
               schema='config')
    op.alter_column('expense_types', 'category',
               existing_type=sa.VARCHAR(length=50),
               nullable=True,
               schema='config')
    op.alter_column('expense_types', 'km_reimbursement_rate',
               existing_type=sa.NUMERIC(precision=5, scale=3),
               type_=sa.Numeric(precision=4, scale=2),
               existing_nullable=True,
               schema='config')
    op.drop_column('expense_types', 'description', schema='config')
    op.alter_column('holidays', 'is_regional',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='config')
    op.alter_column('holidays', 'is_confirmed',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'),
               schema='config')
    op.drop_index('ix_config_holidays_date_location', table_name='holidays', schema='config')
    op.drop_index('ix_config_holidays_year', table_name='holidays', schema='config')
    op.drop_index('ix_holidays_year_type', table_name='holidays', schema='config')
    op.drop_table_comment(
        'holidays',
        existing_comment='DEPRECATED: Data migrated to calendar.holidays. Use Calendar Service for all holiday operations.',
        schema='config'
    )
    op.alter_column('national_contract_levels', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.drop_index('ix_ncl_contract_id', table_name='national_contract_levels', schema='config')
    op.create_index(op.f('ix_config_national_contract_levels_national_contract_id'), 'national_contract_levels', ['national_contract_id'], unique=False, schema='config')
    op.alter_column('national_contract_type_configs', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.alter_column('national_contract_type_configs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.drop_index('ix_nctc_version_id', table_name='national_contract_type_configs', schema='config')
    op.alter_column('national_contract_versions', 'version_name',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='Es: "Rinnovo 2024-2027"',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'valid_from',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='Data inizio validità parametri',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'valid_to',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='Data fine validità (NULL = ancora valido)',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'weekly_hours_full_time',
               existing_type=sa.NUMERIC(precision=4, scale=1),
               comment=None,
               existing_comment='Ore settimanali per full time',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'working_days_per_week',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Giorni lavorativi settimanali (5 o 6)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'daily_hours',
               existing_type=sa.NUMERIC(precision=4, scale=2),
               comment=None,
               existing_comment='Ore giornaliere standard',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'annual_vacation_days',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Giorni ferie annuali base',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'vacation_accrual_method',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Metodo maturazione: monthly, yearly',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'vacation_carryover_months',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Mesi entro cui fruire ferie anno precedente',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'vacation_carryover_deadline_month',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Mese scadenza ferie AP (6 = 30 Giugno)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'vacation_carryover_deadline_day',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Giorno scadenza ferie AP',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'annual_rol_hours',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Ore ROL annuali (varia per dimensione azienda e anzianità)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'rol_accrual_method',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Metodo maturazione ROL',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'rol_carryover_months',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Mesi entro cui fruire ROL anno precedente',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'annual_ex_festivita_hours',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Ore ex-festività annuali (tipicamente 4 giorni x 8h = 32h)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'ex_festivita_accrual_method',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Metodo maturazione ex-festività',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'annual_study_leave_hours',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Ore permesso studio annuali',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'blood_donation_paid_hours',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Ore retribuite per donazione sangue (giornata intera)',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'marriage_leave_days',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Giorni permesso matrimonio',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'bereavement_leave_days',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Giorni permesso lutto',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'l104_monthly_days',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Giorni mensili Legge 104',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'sick_leave_carenza_days',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Giorni carenza malattia (retribuiti da azienda, non INPS)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'sick_leave_max_days_year',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Giorni massimi malattia in comporto',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'seniority_vacation_bonus',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Giorni ferie extra per anzianità: [{"years": 10, "extra_days": 1}, ...]',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'seniority_rol_bonus',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Ore ROL extra per anzianità',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'notes',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Note e riferimenti normativi',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.alter_column('national_contract_versions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.drop_index('ix_ncv_contract_valid_from', table_name='national_contract_versions', schema='config')
    op.alter_column('national_contracts', 'sector',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='Settore economico (Commercio, Metalmeccanico, etc.)',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contracts', 'source_url',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Link al testo ufficiale del CCNL',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contracts', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.alter_column('national_contracts', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.drop_index('ix_config_system_config_key', table_name='system_config', schema='config')
    op.alter_column('business_trips', 'destination_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('NATIONAL', 'EU', 'EXTRA_EU', name='destinationtype', native_enum=False),
               existing_nullable=False,
               existing_server_default=sa.text("'national'::character varying"),
               schema='expenses')
    op.alter_column('business_trips', 'status',
               existing_type=sa.VARCHAR(length=30),
               type_=sa.Enum('DRAFT', 'PENDING', 'SUBMITTED', 'APPROVED', 'REJECTED', 'CANCELLED', 'COMPLETED', name='tripstatus', native_enum=False),
               existing_nullable=False,
               existing_server_default=sa.text("'draft'::character varying"),
               schema='expenses')
    op.drop_index('ix_expenses_business_trips_status', table_name='business_trips', schema='expenses')
    op.drop_index('ix_expenses_business_trips_user_id', table_name='business_trips', schema='expenses')
    op.alter_column('daily_allowances', 'base_amount',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               type_=sa.Numeric(precision=8, scale=2),
               existing_nullable=False,
               schema='expenses')
    op.alter_column('daily_allowances', 'meals_deduction',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               type_=sa.Numeric(precision=8, scale=2),
               existing_nullable=False,
               schema='expenses')
    op.alter_column('daily_allowances', 'final_amount',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               type_=sa.Numeric(precision=8, scale=2),
               existing_nullable=False,
               schema='expenses')
    op.drop_index('ix_expenses_daily_allowances_trip_date', table_name='daily_allowances', schema='expenses')
    op.drop_column('daily_allowances', 'updated_at', schema='expenses')
    op.alter_column('expense_items', 'expense_type_code',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.String(length=10),
               existing_nullable=False,
               schema='expenses')
    op.alter_column('expense_items', 'km_distance',
               existing_type=sa.NUMERIC(precision=7, scale=2),
               type_=sa.Integer(),
               existing_nullable=True,
               schema='expenses')
    op.alter_column('expense_items', 'km_rate',
               existing_type=sa.NUMERIC(precision=5, scale=3),
               type_=sa.Numeric(precision=4, scale=2),
               existing_nullable=True,
               schema='expenses')
    op.alter_column('expense_items', 'receipt_path',
               existing_type=sa.TEXT(),
               type_=sa.String(length=500),
               existing_nullable=True,
               schema='expenses')
    op.drop_index('ix_expenses_expense_items_report', table_name='expense_items', schema='expenses')
    op.drop_column('expense_items', 'updated_at', schema='expenses')
    op.alter_column('expense_reports', 'status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('DRAFT', 'SUBMITTED', 'APPROVED', 'REJECTED', 'CANCELLED', 'PAID', name='expensereportstatus', native_enum=False),
               existing_nullable=False,
               schema='expenses')
    op.drop_index('ix_expenses_expense_reports_status', table_name='expense_reports', schema='expenses')
    op.drop_index('ix_expenses_expense_reports_user_id', table_name='expense_reports', schema='expenses')
    op.drop_constraint('expense_reports_trip_id_fkey', 'expense_reports', schema='expenses', type_='foreignkey')
    op.create_foreign_key(None, 'expense_reports', 'business_trips', ['trip_id'], ['id'], source_schema='expenses', referent_schema='expenses', ondelete='SET NULL')
    op.alter_column('daily_snapshots', 'total_employees',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'employees_on_leave',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'employees_on_trip',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'employees_sick',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'absence_rate',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'pending_leave_requests',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'approved_leave_today',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'pending_expense_reports',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'total_expenses_submitted',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'vacation_days_taken',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'vacation_hours_taken',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'rol_days_taken',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'rol_hours_taken',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'permit_hours_taken',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'sick_days',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'sick_hours',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'other_absence_days',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'vacation_balance_ap',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'vacation_balance_ac',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'rol_balance',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'permit_balance',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'trips_count',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'trips_total_days',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'expenses_total',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'allowances_total',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.drop_index('ix_employee_monthly_stats_period', table_name='employee_monthly_stats', schema='hr_reporting')
    op.alter_column('generated_reports', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               existing_server_default=sa.text("'pending'::character varying"),
               schema='hr_reporting')
    op.alter_column('generated_reports', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('generated_reports', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.drop_index('ix_generated_reports_period', table_name='generated_reports', schema='hr_reporting')
    op.alter_column('hr_alerts', 'severity',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               existing_server_default=sa.text("'info'::character varying"),
               schema='hr_reporting')
    op.alter_column('hr_alerts', 'description',
               existing_type=sa.TEXT(),
               nullable=False,
               schema='hr_reporting')
    op.alter_column('hr_alerts', 'action_required',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='hr_reporting')
    op.alter_column('hr_alerts', 'is_active',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'),
               schema='hr_reporting')
    op.alter_column('hr_alerts', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.drop_index('ix_hr_alerts_active_severity', table_name='hr_alerts', schema='hr_reporting')
    op.alter_column('medical_records', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('medical_records', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.drop_index('ix_medical_records_employee_id', table_name='medical_records', schema='hr_reporting')
    op.drop_index('ix_medical_records_next_visit_date', table_name='medical_records', schema='hr_reporting')
    op.create_index(op.f('ix_hr_reporting_medical_records_employee_id'), 'medical_records', ['employee_id'], unique=False, schema='hr_reporting')
    op.create_index(op.f('ix_hr_reporting_medical_records_next_visit_date'), 'medical_records', ['next_visit_date'], unique=False, schema='hr_reporting')
    op.alter_column('safety_compliance', 'is_compliant',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'compliance_score',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('100'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'has_formazione_generale',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'has_formazione_specifica',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'trainings_expiring_soon',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'trainings_expired',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'medical_fitness_valid',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.drop_index('ix_safety_compliance_employee_id', table_name='safety_compliance', schema='hr_reporting')
    op.drop_index('ix_safety_compliance_is_compliant', table_name='safety_compliance', schema='hr_reporting')
    op.drop_constraint('safety_compliance_employee_id_key', 'safety_compliance', schema='hr_reporting', type_='unique')
    op.create_index(op.f('ix_hr_reporting_safety_compliance_employee_id'), 'safety_compliance', ['employee_id'], unique=True, schema='hr_reporting')
    op.create_index(op.f('ix_hr_reporting_safety_compliance_is_compliant'), 'safety_compliance', ['is_compliant'], unique=False, schema='hr_reporting')
    op.alter_column('training_records', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               existing_server_default=sa.text("'valido'::character varying"),
               schema='hr_reporting')
    op.alter_column('training_records', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('training_records', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.drop_index('ix_training_records_employee_id', table_name='training_records', schema='hr_reporting')
    op.drop_index('ix_training_records_expiry_date', table_name='training_records', schema='hr_reporting')
    op.drop_index('ix_training_records_status', table_name='training_records', schema='hr_reporting')
    op.drop_index('ix_training_records_training_type', table_name='training_records', schema='hr_reporting')
    op.create_index(op.f('ix_hr_reporting_training_records_employee_id'), 'training_records', ['employee_id'], unique=False, schema='hr_reporting')
    op.create_index(op.f('ix_hr_reporting_training_records_expiry_date'), 'training_records', ['expiry_date'], unique=False, schema='hr_reporting')
    op.create_index(op.f('ix_hr_reporting_training_records_status'), 'training_records', ['status'], unique=False, schema='hr_reporting')
    op.create_index(op.f('ix_hr_reporting_training_records_training_type'), 'training_records', ['training_type'], unique=False, schema='hr_reporting')
    op.alter_column('approval_delegations', 'delegation_type',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               schema='leaves')
    op.alter_column('approval_delegations', 'is_active',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               schema='leaves')
    op.alter_column('approval_delegations', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='leaves')
    op.drop_index('ix_approval_delegations_active', table_name='approval_delegations', schema='leaves')
    op.alter_column('balance_reservations', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               schema='leaves')
    op.alter_column('balance_reservations', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='leaves')
    op.drop_index('ix_balance_reservations_pending', table_name='balance_reservations', schema='leaves')
    op.alter_column('leave_interruptions', 'days_refunded',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=False,
               schema='leaves')
    op.alter_column('leave_interruptions', 'initiated_by_role',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               schema='leaves')
    op.alter_column('leave_interruptions', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               schema='leaves')
    op.alter_column('leave_interruptions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='leaves')
    op.alter_column('leave_interruptions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='leaves')
    op.drop_index('ix_leave_interruptions_type', table_name='leave_interruptions', schema='leaves')
    op.drop_index('ix_leaves_leave_interruptions_leave_request_id', table_name='leave_interruptions', schema='leaves')
    op.alter_column('leave_request_history', 'from_status',
               existing_type=sa.VARCHAR(length=30),
               type_=sa.Enum('DRAFT', 'PENDING', 'APPROVED', 'APPROVED_CONDITIONAL', 'REJECTED', 'CANCELLED', 'RECALLED', 'COMPLETED', name='leaverequeststatus', native_enum=False),
               existing_nullable=True,
               schema='leaves')
    op.alter_column('leave_request_history', 'to_status',
               existing_type=sa.VARCHAR(length=30),
               type_=sa.Enum('DRAFT', 'PENDING', 'APPROVED', 'APPROVED_CONDITIONAL', 'REJECTED', 'CANCELLED', 'RECALLED', 'COMPLETED', name='leaverequeststatus', native_enum=False),
               existing_nullable=False,
               schema='leaves')
    op.drop_index('ix_leaves_leave_request_history_request', table_name='leave_request_history', schema='leaves')
    op.alter_column('leave_requests', 'leave_type_code',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.String(length=10),
               existing_nullable=False,
               schema='leaves')
    op.alter_column('leave_requests', 'status',
               existing_type=sa.VARCHAR(length=30),
               type_=sa.Enum('DRAFT', 'PENDING', 'APPROVED', 'APPROVED_CONDITIONAL', 'REJECTED', 'CANCELLED', 'RECALLED', 'COMPLETED', name='leaverequeststatus', native_enum=False),
               existing_nullable=False,
               schema='leaves')
    op.alter_column('leave_requests', 'condition_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('RIC', 'REP', 'PAR', 'MOD', 'ALT', name='conditiontype', native_enum=False),
               existing_nullable=True,
               schema='leaves')
    op.alter_column('leave_requests', 'attachment_path',
               existing_type=sa.TEXT(),
               type_=sa.String(length=500),
               existing_nullable=True,
               schema='leaves')
    op.alter_column('leave_requests', 'has_interruptions',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               schema='leaves')
    op.drop_index('ix_leaves_leave_requests_start_date', table_name='leave_requests', schema='leaves')
    op.drop_index('ix_leaves_leave_requests_status', table_name='leave_requests', schema='leaves')
    op.drop_index('ix_leaves_leave_requests_user_id', table_name='leave_requests', schema='leaves')
    op.drop_column('leave_requests', 'cancellation_reason', schema='leaves')
    op.drop_column('leave_requests', 'submitted_at', schema='leaves')
    op.drop_column('leave_requests', 'cancelled_at', schema='leaves')
    op.drop_column('leave_requests', 'actual_return_date', schema='leaves')
    op.drop_column('leave_requests', 'compensation_days', schema='leaves')
    op.alter_column('email_logs', 'retry_count',
               existing_type=sa.INTEGER(),
               nullable=False,
               schema='notifications')
    op.alter_column('email_logs', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='notifications')
    op.alter_column('email_logs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'),
               schema='notifications')
    op.drop_index('ix_email_logs_created_at', table_name='email_logs', schema='notifications')
    op.drop_index('ix_email_provider_settings_provider_active', table_name='email_provider_settings', schema='notifications')
    op.drop_index('ix_notifications_notifications_notification_type', table_name='notifications', schema='notifications')
    op.drop_index('ix_notifications_notifications_user_id', table_name='notifications', schema='notifications')
    op.drop_index('ix_push_subscriptions_endpoint', table_name='push_subscriptions', schema='notifications')
    op.drop_constraint('sw_agreements_created_by_fkey', 'sw_agreements', schema='smart_working', type_='foreignkey')
    op.drop_constraint('sw_agreements_user_id_fkey', 'sw_agreements', schema='smart_working', type_='foreignkey')
    op.drop_constraint('sw_requests_user_id_fkey', 'sw_requests', schema='smart_working', type_='foreignkey')
    op.drop_constraint('sw_requests_approval_request_id_fkey', 'sw_requests', schema='smart_working', type_='foreignkey')
    op.drop_constraint('sw_requests_approver_id_fkey', 'sw_requests', schema='smart_working', type_='foreignkey')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_foreign_key('sw_requests_approver_id_fkey', 'sw_requests', 'users', ['approver_id'], ['id'], source_schema='smart_working')
    op.create_foreign_key('sw_requests_approval_request_id_fkey', 'sw_requests', 'approval_requests', ['approval_request_id'], ['id'], source_schema='smart_working')
    op.create_foreign_key('sw_requests_user_id_fkey', 'sw_requests', 'users', ['user_id'], ['id'], source_schema='smart_working')
    op.create_foreign_key('sw_agreements_user_id_fkey', 'sw_agreements', 'users', ['user_id'], ['id'], source_schema='smart_working')
    op.create_foreign_key('sw_agreements_created_by_fkey', 'sw_agreements', 'users', ['created_by'], ['id'], source_schema='smart_working')
    op.create_index('ix_push_subscriptions_endpoint', 'push_subscriptions', ['endpoint'], unique=False, schema='notifications')
    op.create_index('ix_notifications_notifications_user_id', 'notifications', ['user_id'], unique=False, schema='notifications')
    op.create_index('ix_notifications_notifications_notification_type', 'notifications', ['notification_type'], unique=False, schema='notifications')
    op.create_index('ix_email_provider_settings_provider_active', 'email_provider_settings', ['provider', 'is_active'], unique=False, schema='notifications')
    op.create_index('ix_email_logs_created_at', 'email_logs', ['created_at'], unique=False, schema='notifications')
    op.alter_column('email_logs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='notifications')
    op.alter_column('email_logs', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='notifications')
    op.alter_column('email_logs', 'retry_count',
               existing_type=sa.INTEGER(),
               nullable=True,
               schema='notifications')
    op.add_column('leave_requests', sa.Column('compensation_days', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True), schema='leaves')
    op.add_column('leave_requests', sa.Column('actual_return_date', sa.DATE(), autoincrement=False, nullable=True), schema='leaves')
    op.add_column('leave_requests', sa.Column('cancelled_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True), schema='leaves')
    op.add_column('leave_requests', sa.Column('submitted_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True), schema='leaves')
    op.add_column('leave_requests', sa.Column('cancellation_reason', sa.TEXT(), autoincrement=False, nullable=True), schema='leaves')
    op.create_index('ix_leaves_leave_requests_user_id', 'leave_requests', ['user_id'], unique=False, schema='leaves')
    op.create_index('ix_leaves_leave_requests_status', 'leave_requests', ['status'], unique=False, schema='leaves')
    op.create_index('ix_leaves_leave_requests_start_date', 'leave_requests', ['start_date'], unique=False, schema='leaves')
    op.alter_column('leave_requests', 'has_interruptions',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               schema='leaves')
    op.alter_column('leave_requests', 'attachment_path',
               existing_type=sa.String(length=500),
               type_=sa.TEXT(),
               existing_nullable=True,
               schema='leaves')
    op.alter_column('leave_requests', 'condition_type',
               existing_type=sa.Enum('RIC', 'REP', 'PAR', 'MOD', 'ALT', name='conditiontype', native_enum=False),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True,
               schema='leaves')
    op.alter_column('leave_requests', 'status',
               existing_type=sa.Enum('DRAFT', 'PENDING', 'APPROVED', 'APPROVED_CONDITIONAL', 'REJECTED', 'CANCELLED', 'RECALLED', 'COMPLETED', name='leaverequeststatus', native_enum=False),
               type_=sa.VARCHAR(length=30),
               existing_nullable=False,
               schema='leaves')
    op.alter_column('leave_requests', 'leave_type_code',
               existing_type=sa.String(length=10),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False,
               schema='leaves')
    op.create_index('ix_leaves_leave_request_history_request', 'leave_request_history', ['leave_request_id'], unique=False, schema='leaves')
    op.alter_column('leave_request_history', 'to_status',
               existing_type=sa.Enum('DRAFT', 'PENDING', 'APPROVED', 'APPROVED_CONDITIONAL', 'REJECTED', 'CANCELLED', 'RECALLED', 'COMPLETED', name='leaverequeststatus', native_enum=False),
               type_=sa.VARCHAR(length=30),
               existing_nullable=False,
               schema='leaves')
    op.alter_column('leave_request_history', 'from_status',
               existing_type=sa.Enum('DRAFT', 'PENDING', 'APPROVED', 'APPROVED_CONDITIONAL', 'REJECTED', 'CANCELLED', 'RECALLED', 'COMPLETED', name='leaverequeststatus', native_enum=False),
               type_=sa.VARCHAR(length=30),
               existing_nullable=True,
               schema='leaves')
    op.create_index('ix_leaves_leave_interruptions_leave_request_id', 'leave_interruptions', ['leave_request_id'], unique=False, schema='leaves')
    op.create_index('ix_leave_interruptions_type', 'leave_interruptions', ['interruption_type', 'status'], unique=False, schema='leaves')
    op.alter_column('leave_interruptions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='leaves')
    op.alter_column('leave_interruptions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='leaves')
    op.alter_column('leave_interruptions', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               schema='leaves')
    op.alter_column('leave_interruptions', 'initiated_by_role',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               schema='leaves')
    op.alter_column('leave_interruptions', 'days_refunded',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=True,
               schema='leaves')
    op.create_index('ix_balance_reservations_pending', 'balance_reservations', ['user_id', 'status'], unique=False, schema='leaves')
    op.alter_column('balance_reservations', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='leaves')
    op.alter_column('balance_reservations', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               schema='leaves')
    op.create_index('ix_approval_delegations_active', 'approval_delegations', ['delegate_id', 'is_active', 'start_date', 'end_date'], unique=False, schema='leaves')
    op.alter_column('approval_delegations', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='leaves')
    op.alter_column('approval_delegations', 'is_active',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               schema='leaves')
    op.alter_column('approval_delegations', 'delegation_type',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               schema='leaves')
    op.drop_index(op.f('ix_hr_reporting_training_records_training_type'), table_name='training_records', schema='hr_reporting')
    op.drop_index(op.f('ix_hr_reporting_training_records_status'), table_name='training_records', schema='hr_reporting')
    op.drop_index(op.f('ix_hr_reporting_training_records_expiry_date'), table_name='training_records', schema='hr_reporting')
    op.drop_index(op.f('ix_hr_reporting_training_records_employee_id'), table_name='training_records', schema='hr_reporting')
    op.create_index('ix_training_records_training_type', 'training_records', ['training_type'], unique=False, schema='hr_reporting')
    op.create_index('ix_training_records_status', 'training_records', ['status'], unique=False, schema='hr_reporting')
    op.create_index('ix_training_records_expiry_date', 'training_records', ['expiry_date'], unique=False, schema='hr_reporting')
    op.create_index('ix_training_records_employee_id', 'training_records', ['employee_id'], unique=False, schema='hr_reporting')
    op.alter_column('training_records', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('training_records', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('training_records', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               existing_server_default=sa.text("'valido'::character varying"),
               schema='hr_reporting')
    op.drop_index(op.f('ix_hr_reporting_safety_compliance_is_compliant'), table_name='safety_compliance', schema='hr_reporting')
    op.drop_index(op.f('ix_hr_reporting_safety_compliance_employee_id'), table_name='safety_compliance', schema='hr_reporting')
    op.create_unique_constraint('safety_compliance_employee_id_key', 'safety_compliance', ['employee_id'], schema='hr_reporting')
    op.create_index('ix_safety_compliance_is_compliant', 'safety_compliance', ['is_compliant'], unique=False, schema='hr_reporting')
    op.create_index('ix_safety_compliance_employee_id', 'safety_compliance', ['employee_id'], unique=False, schema='hr_reporting')
    op.alter_column('safety_compliance', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'medical_fitness_valid',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'trainings_expired',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'trainings_expiring_soon',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'has_formazione_specifica',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'has_formazione_generale',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'compliance_score',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('100'),
               schema='hr_reporting')
    op.alter_column('safety_compliance', 'is_compliant',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'),
               schema='hr_reporting')
    op.drop_index(op.f('ix_hr_reporting_medical_records_next_visit_date'), table_name='medical_records', schema='hr_reporting')
    op.drop_index(op.f('ix_hr_reporting_medical_records_employee_id'), table_name='medical_records', schema='hr_reporting')
    op.create_index('ix_medical_records_next_visit_date', 'medical_records', ['next_visit_date'], unique=False, schema='hr_reporting')
    op.create_index('ix_medical_records_employee_id', 'medical_records', ['employee_id'], unique=False, schema='hr_reporting')
    op.alter_column('medical_records', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('medical_records', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.create_index('ix_hr_alerts_active_severity', 'hr_alerts', ['is_active', 'severity', 'created_at'], unique=False, schema='hr_reporting')
    op.alter_column('hr_alerts', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('hr_alerts', 'is_active',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'),
               schema='hr_reporting')
    op.alter_column('hr_alerts', 'action_required',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='hr_reporting')
    op.alter_column('hr_alerts', 'description',
               existing_type=sa.TEXT(),
               nullable=True,
               schema='hr_reporting')
    op.alter_column('hr_alerts', 'severity',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               existing_server_default=sa.text("'info'::character varying"),
               schema='hr_reporting')
    op.create_index('ix_generated_reports_period', 'generated_reports', ['report_type', 'period_start', 'department_id'], unique=False, schema='hr_reporting')
    op.alter_column('generated_reports', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('generated_reports', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('generated_reports', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               existing_server_default=sa.text("'pending'::character varying"),
               schema='hr_reporting')
    op.create_index('ix_employee_monthly_stats_period', 'employee_monthly_stats', ['employee_id', 'year', 'month'], unique=True, schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'allowances_total',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'expenses_total',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'trips_total_days',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'trips_count',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'permit_balance',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'rol_balance',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'vacation_balance_ac',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'vacation_balance_ap',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'other_absence_days',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'sick_hours',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'sick_days',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'permit_hours_taken',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'rol_hours_taken',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'rol_days_taken',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'vacation_hours_taken',
               existing_type=sa.NUMERIC(precision=6, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('employee_monthly_stats', 'vacation_days_taken',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'total_expenses_submitted',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'pending_expense_reports',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'approved_leave_today',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'pending_leave_requests',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'absence_rate',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'employees_sick',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'employees_on_trip',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'employees_on_leave',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.alter_column('daily_snapshots', 'total_employees',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='hr_reporting')
    op.drop_constraint(None, 'expense_reports', schema='expenses', type_='foreignkey')
    op.create_foreign_key('expense_reports_trip_id_fkey', 'expense_reports', 'business_trips', ['trip_id'], ['id'], source_schema='expenses', referent_schema='expenses', ondelete='CASCADE')
    op.create_index('ix_expenses_expense_reports_user_id', 'expense_reports', ['user_id'], unique=False, schema='expenses')
    op.create_index('ix_expenses_expense_reports_status', 'expense_reports', ['status'], unique=False, schema='expenses')
    op.alter_column('expense_reports', 'status',
               existing_type=sa.Enum('DRAFT', 'SUBMITTED', 'APPROVED', 'REJECTED', 'CANCELLED', 'PAID', name='expensereportstatus', native_enum=False),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False,
               schema='expenses')
    op.add_column('expense_items', sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False), schema='expenses')
    op.create_index('ix_expenses_expense_items_report', 'expense_items', ['report_id'], unique=False, schema='expenses')
    op.alter_column('expense_items', 'receipt_path',
               existing_type=sa.String(length=500),
               type_=sa.TEXT(),
               existing_nullable=True,
               schema='expenses')
    op.alter_column('expense_items', 'km_rate',
               existing_type=sa.Numeric(precision=4, scale=2),
               type_=sa.NUMERIC(precision=5, scale=3),
               existing_nullable=True,
               schema='expenses')
    op.alter_column('expense_items', 'km_distance',
               existing_type=sa.Integer(),
               type_=sa.NUMERIC(precision=7, scale=2),
               existing_nullable=True,
               schema='expenses')
    op.alter_column('expense_items', 'expense_type_code',
               existing_type=sa.String(length=10),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False,
               schema='expenses')
    op.add_column('daily_allowances', sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False), schema='expenses')
    op.create_index('ix_expenses_daily_allowances_trip_date', 'daily_allowances', ['trip_id', 'date'], unique=True, schema='expenses')
    op.alter_column('daily_allowances', 'final_amount',
               existing_type=sa.Numeric(precision=8, scale=2),
               type_=sa.NUMERIC(precision=10, scale=2),
               existing_nullable=False,
               schema='expenses')
    op.alter_column('daily_allowances', 'meals_deduction',
               existing_type=sa.Numeric(precision=8, scale=2),
               type_=sa.NUMERIC(precision=10, scale=2),
               existing_nullable=False,
               schema='expenses')
    op.alter_column('daily_allowances', 'base_amount',
               existing_type=sa.Numeric(precision=8, scale=2),
               type_=sa.NUMERIC(precision=10, scale=2),
               existing_nullable=False,
               schema='expenses')
    op.create_index('ix_expenses_business_trips_user_id', 'business_trips', ['user_id'], unique=False, schema='expenses')
    op.create_index('ix_expenses_business_trips_status', 'business_trips', ['status'], unique=False, schema='expenses')
    op.alter_column('business_trips', 'status',
               existing_type=sa.Enum('DRAFT', 'PENDING', 'SUBMITTED', 'APPROVED', 'REJECTED', 'CANCELLED', 'COMPLETED', name='tripstatus', native_enum=False),
               type_=sa.VARCHAR(length=30),
               existing_nullable=False,
               existing_server_default=sa.text("'draft'::character varying"),
               schema='expenses')
    op.alter_column('business_trips', 'destination_type',
               existing_type=sa.Enum('NATIONAL', 'EU', 'EXTRA_EU', name='destinationtype', native_enum=False),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False,
               existing_server_default=sa.text("'national'::character varying"),
               schema='expenses')
    op.create_index('ix_config_system_config_key', 'system_config', ['key'], unique=True, schema='config')
    op.alter_column('national_contracts', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.alter_column('national_contracts', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.alter_column('national_contracts', 'source_url',
               existing_type=sa.TEXT(),
               comment='Link al testo ufficiale del CCNL',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contracts', 'sector',
               existing_type=sa.VARCHAR(length=100),
               comment='Settore economico (Commercio, Metalmeccanico, etc.)',
               existing_nullable=True,
               schema='config')
    op.create_index('ix_ncv_contract_valid_from', 'national_contract_versions', ['national_contract_id', 'valid_from'], unique=False, schema='config')
    op.alter_column('national_contract_versions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.alter_column('national_contract_versions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.alter_column('national_contract_versions', 'notes',
               existing_type=sa.TEXT(),
               comment='Note e riferimenti normativi',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'seniority_rol_bonus',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Ore ROL extra per anzianità',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'seniority_vacation_bonus',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Giorni ferie extra per anzianità: [{"years": 10, "extra_days": 1}, ...]',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'sick_leave_max_days_year',
               existing_type=sa.INTEGER(),
               comment='Giorni massimi malattia in comporto',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'sick_leave_carenza_days',
               existing_type=sa.INTEGER(),
               comment='Giorni carenza malattia (retribuiti da azienda, non INPS)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'l104_monthly_days',
               existing_type=sa.INTEGER(),
               comment='Giorni mensili Legge 104',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'bereavement_leave_days',
               existing_type=sa.INTEGER(),
               comment='Giorni permesso lutto',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'marriage_leave_days',
               existing_type=sa.INTEGER(),
               comment='Giorni permesso matrimonio',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'blood_donation_paid_hours',
               existing_type=sa.INTEGER(),
               comment='Ore retribuite per donazione sangue (giornata intera)',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'annual_study_leave_hours',
               existing_type=sa.INTEGER(),
               comment='Ore permesso studio annuali',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'ex_festivita_accrual_method',
               existing_type=sa.VARCHAR(length=20),
               comment='Metodo maturazione ex-festività',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'annual_ex_festivita_hours',
               existing_type=sa.INTEGER(),
               comment='Ore ex-festività annuali (tipicamente 4 giorni x 8h = 32h)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'rol_carryover_months',
               existing_type=sa.INTEGER(),
               comment='Mesi entro cui fruire ROL anno precedente',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'rol_accrual_method',
               existing_type=sa.VARCHAR(length=20),
               comment='Metodo maturazione ROL',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'annual_rol_hours',
               existing_type=sa.INTEGER(),
               comment='Ore ROL annuali (varia per dimensione azienda e anzianità)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'vacation_carryover_deadline_day',
               existing_type=sa.INTEGER(),
               comment='Giorno scadenza ferie AP',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'vacation_carryover_deadline_month',
               existing_type=sa.INTEGER(),
               comment='Mese scadenza ferie AP (6 = 30 Giugno)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'vacation_carryover_months',
               existing_type=sa.INTEGER(),
               comment='Mesi entro cui fruire ferie anno precedente',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'vacation_accrual_method',
               existing_type=sa.VARCHAR(length=20),
               comment='Metodo maturazione: monthly, yearly',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'annual_vacation_days',
               existing_type=sa.INTEGER(),
               comment='Giorni ferie annuali base',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'daily_hours',
               existing_type=sa.NUMERIC(precision=4, scale=2),
               comment='Ore giornaliere standard',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'working_days_per_week',
               existing_type=sa.INTEGER(),
               comment='Giorni lavorativi settimanali (5 o 6)',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'weekly_hours_full_time',
               existing_type=sa.NUMERIC(precision=4, scale=1),
               comment='Ore settimanali per full time',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'valid_to',
               existing_type=sa.DATE(),
               comment='Data fine validità (NULL = ancora valido)',
               existing_nullable=True,
               schema='config')
    op.alter_column('national_contract_versions', 'valid_from',
               existing_type=sa.DATE(),
               comment='Data inizio validità parametri',
               existing_nullable=False,
               schema='config')
    op.alter_column('national_contract_versions', 'version_name',
               existing_type=sa.VARCHAR(length=100),
               comment='Es: "Rinnovo 2024-2027"',
               existing_nullable=False,
               schema='config')
    op.create_index('ix_nctc_version_id', 'national_contract_type_configs', ['national_contract_version_id'], unique=False, schema='config')
    op.alter_column('national_contract_type_configs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.alter_column('national_contract_type_configs', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.drop_index(op.f('ix_config_national_contract_levels_national_contract_id'), table_name='national_contract_levels', schema='config')
    op.create_index('ix_ncl_contract_id', 'national_contract_levels', ['national_contract_id'], unique=False, schema='config')
    op.alter_column('national_contract_levels', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='config')
    op.create_table_comment(
        'holidays',
        'DEPRECATED: Data migrated to calendar.holidays. Use Calendar Service for all holiday operations.',
        existing_comment=None,
        schema='config'
    )
    op.create_index('ix_holidays_year_type', 'holidays', ['year', 'is_national', 'is_regional'], unique=False, schema='config')
    op.create_index('ix_config_holidays_year', 'holidays', ['year'], unique=False, schema='config')
    op.create_index('ix_config_holidays_date_location', 'holidays', ['date', 'location_id'], unique=True, schema='config')
    op.alter_column('holidays', 'is_confirmed',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'),
               schema='config')
    op.alter_column('holidays', 'is_regional',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='config')
    op.add_column('expense_types', sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True), schema='config')
    op.alter_column('expense_types', 'km_reimbursement_rate',
               existing_type=sa.Numeric(precision=4, scale=2),
               type_=sa.NUMERIC(precision=5, scale=3),
               existing_nullable=True,
               schema='config')
    op.alter_column('expense_types', 'category',
               existing_type=sa.VARCHAR(length=50),
               nullable=False,
               schema='config')
    op.alter_column('expense_types', 'code',
               existing_type=sa.String(length=10),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False,
               schema='config')
    op.add_column('contract_types', sa.Column('national_contract_id', sa.UUID(), autoincrement=False, nullable=True), schema='config')
    op.create_foreign_key('fk_contract_types_national_contract', 'contract_types', 'national_contracts', ['national_contract_id'], ['id'], source_schema='config', referent_schema='config', ondelete='SET NULL')
    op.drop_constraint(None, 'contract_types', schema='config', type_='unique')
    op.create_index('ix_config_contract_types_code', 'contract_types', ['code'], unique=True, schema='config')
    op.alter_column('contract_types', 'description',
               existing_type=sa.String(length=200),
               type_=sa.VARCHAR(length=255),
               existing_nullable=True,
               schema='config')
    op.create_table_comment(
        'company_closures',
        'DEPRECATED: Data migrated to calendar.closures. Use Calendar Service for all closure operations.',
        existing_comment=None,
        schema='config'
    )
    op.create_index('ix_config_company_closures_year', 'company_closures', ['year'], unique=False, schema='config')
    op.create_index('ix_config_closures_dates', 'company_closures', ['start_date', 'end_date'], unique=False, schema='config')
    op.alter_column('calculation_modes', 'default_parameters',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               nullable=True,
               schema='config')
    op.add_column('working_day_exceptions', sa.Column('department_code', sa.VARCHAR(length=50), autoincrement=False, nullable=True), schema='calendar')
    op.add_column('working_day_exceptions', sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True), schema='calendar')
    op.add_column('working_day_exceptions', sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False), schema='calendar')
    op.create_index('ix_calendar_working_day_exceptions_year', 'working_day_exceptions', ['year'], unique=False, schema='calendar')
    op.alter_column('holidays', 'date',
               existing_type=sa.DATE(),
               nullable=False,
               schema='calendar')
    op.create_index('ix_calendar_events_user_id', 'events', ['user_id'], unique=False, schema='calendar')
    op.alter_column('events', 'calendar_id',
               existing_type=sa.UUID(),
               nullable=True,
               schema='calendar')
    op.add_column('event_participants', sa.Column('responded_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True), schema='calendar')
    op.add_column('event_participants', sa.Column('is_optional', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False), schema='calendar')
    op.create_index('ix_calendar_event_participants_user_id', 'event_participants', ['user_id'], unique=False, schema='calendar')
    op.create_index('ix_calendar_event_participants_event_id', 'event_participants', ['event_id'], unique=False, schema='calendar')
    op.add_column('closures', sa.Column('consumes_leave_balance', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False), schema='calendar')
    op.add_column('closures', sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True), schema='calendar')
    op.add_column('closures', sa.Column('affected_locations', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True), schema='calendar')
    op.add_column('closures', sa.Column('leave_type_code', sa.VARCHAR(length=10), autoincrement=False, nullable=True), schema='calendar')
    op.add_column('closures', sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False), schema='calendar')
    op.add_column('closures', sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True), schema='calendar')
    op.add_column('closures', sa.Column('closure_type', sa.VARCHAR(length=20), server_default=sa.text("'total'::character varying"), autoincrement=False, nullable=False), schema='calendar')
    op.add_column('closures', sa.Column('affected_departments', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True), schema='calendar')
    op.add_column('closures', sa.Column('is_paid', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False), schema='calendar')
    op.add_column('closures', sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False), schema='calendar')
    op.add_column('closures', sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False), schema='calendar')
    op.create_index('ix_calendar_closures_year', 'closures', ['year'], unique=False, schema='calendar')
    op.create_index('ix_calendar_closures_start_date', 'closures', ['start_date'], unique=False, schema='calendar')
    op.create_index('ix_calendar_closures_end_date', 'closures', ['end_date'], unique=False, schema='calendar')
    op.alter_column('calendars', 'type',
               existing_type=sa.Enum('SYSTEM', 'LOCATION', 'PERSONAL', 'TEAM', name='calendartype', native_enum=False),
               type_=postgresql.ENUM('SYSTEM', 'LOCATION', 'PERSONAL', 'TEAM', name='calendartype'),
               existing_nullable=False,
               schema='calendar')
    op.alter_column('calendar_shares', 'permission',
               existing_type=sa.Enum('READ', 'WRITE', 'ADMIN', name='calendarpermission', native_enum=False),
               type_=postgresql.ENUM('READ', 'WRITE', 'ADMIN', name='calendarpermission'),
               existing_nullable=False,
               existing_server_default=sa.text("'READ'::calendarpermission"),
               schema='calendar')
    op.drop_constraint(None, 'users', schema='auth', type_='foreignkey')
    op.drop_constraint(None, 'users', schema='auth', type_='foreignkey')
    op.create_foreign_key('users_manager_id_fkey', 'users', 'users', ['manager_id'], ['id'], source_schema='auth', referent_schema='auth', ondelete='SET NULL')
    op.create_foreign_key('users_contract_type_id_fkey', 'users', 'contract_types', ['contract_type_id'], ['id'], source_schema='auth')
    op.drop_constraint(None, 'users', schema='auth', type_='unique')
    op.drop_constraint(None, 'users', schema='auth', type_='unique')
    op.drop_constraint(None, 'users', schema='auth', type_='unique')
    op.drop_constraint(None, 'users', schema='auth', type_='unique')
    op.create_index('ix_auth_users_keycloak_id', 'users', ['keycloak_id'], unique=True, schema='auth')
    op.create_index('ix_auth_users_email', 'users', ['email'], unique=True, schema='auth')
    op.alter_column('users', 'keycloak_id',
               existing_type=sa.String(length=50),
               type_=sa.VARCHAR(length=255),
               existing_nullable=False,
               schema='auth')
    op.alter_column('roles', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='auth')
    op.alter_column('roles', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='auth')
    op.alter_column('role_permissions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='auth')
    op.alter_column('permissions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='auth')
    op.drop_constraint(None, 'employee_contracts', schema='auth', type_='foreignkey')
    op.drop_constraint(None, 'employee_contracts', schema='auth', type_='foreignkey')
    op.drop_constraint(None, 'employee_contracts', schema='auth', type_='foreignkey')
    op.create_foreign_key('fk_employee_contracts_national_contract', 'employee_contracts', 'national_contracts', ['national_contract_id'], ['id'], source_schema='auth')
    op.create_foreign_key('fk_employee_contracts_level', 'employee_contracts', 'national_contract_levels', ['level_id'], ['id'], source_schema='auth')
    op.create_index('ix_audit_trail_entity', 'audit_trail', ['entity_type', 'entity_id'], unique=False, schema='audit')
    op.create_index('ix_audit_trail_changed_by', 'audit_trail', ['changed_by'], unique=False, schema='audit')
    op.create_index('ix_audit_trail_changed_at', 'audit_trail', ['changed_at'], unique=False, schema='audit')
    op.create_index('ix_audit_logs_user_id', 'audit_logs', ['user_id'], unique=False, schema='audit')
    op.create_index('ix_audit_logs_resource', 'audit_logs', ['resource_type', 'resource_id'], unique=False, schema='audit')
    op.create_index('ix_audit_logs_created_at', 'audit_logs', ['created_at'], unique=False, schema='audit')
    op.create_index('ix_audit_logs_admin_query', 'audit_logs', ['service_name', 'action', 'status', 'created_at'], unique=False, schema='audit')
    op.create_unique_constraint('uq_workflow_entity_name', 'workflow_configs', ['entity_type', 'name'], schema='approvals')
    op.alter_column('workflow_configs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.alter_column('workflow_configs', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.alter_column('workflow_configs', 'is_default',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('workflow_configs', 'is_active',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'),
               schema='approvals')
    op.alter_column('workflow_configs', 'send_reminders',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'),
               schema='approvals')
    op.alter_column('workflow_configs', 'allow_self_approval',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('workflow_configs', 'auto_assign_approvers',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.create_unique_constraint('uq_entity_request', 'approval_requests', ['entity_type', 'entity_id'], schema='approvals')
    op.create_index('idx_approval_requests_pending_expires', 'approval_requests', ['expires_at'], unique=False, schema='approvals', postgresql_where="((status)::text = 'PENDING'::text)")
    op.alter_column('approval_requests', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.alter_column('approval_requests', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.alter_column('approval_requests', 'expired_action_taken',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('approval_requests', 'max_level',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('1'),
               schema='approvals')
    op.alter_column('approval_requests', 'current_level',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('1'),
               schema='approvals')
    op.alter_column('approval_requests', 'received_rejections',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='approvals')
    op.alter_column('approval_requests', 'received_approvals',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'),
               schema='approvals')
    op.alter_column('approval_reminders', 'is_sent',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'),
               schema='approvals')
    op.alter_column('approval_history', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.create_unique_constraint('uq_approver_request', 'approval_decisions', ['approval_request_id', 'approver_id'], schema='approvals')
    op.create_index('idx_approval_decisions_pending', 'approval_decisions', ['approval_request_id'], unique=False, schema='approvals', postgresql_where='(decided_at IS NULL)')
    op.alter_column('approval_decisions', 'assigned_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'),
               schema='approvals')
    op.alter_column('approval_decisions', 'approval_level',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('1'),
               schema='approvals')
    op.create_table('location_subscriptions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('location_calendar_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('location_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('calendar_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['calendar_id'], ['calendars.id'], name='location_subscriptions_calendar_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['location_calendar_id'], ['location_calendars.id'], name='location_subscriptions_location_calendar_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='location_subscriptions_pkey'),
    sa.UniqueConstraint('location_id', 'calendar_id', name='uq_location_subscription')
    )
    op.create_table('email_provider_settings',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('provider', sa.VARCHAR(length=20), server_default=sa.text("'brevo'::character varying"), autoincrement=False, nullable=False),
    sa.Column('api_key', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('sender_email', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('sender_name', sa.VARCHAR(length=100), server_default=sa.text("'KRONOS HR'::character varying"), autoincrement=False, nullable=False),
    sa.Column('reply_to_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('reply_to_name', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('test_mode', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('test_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('webhook_secret', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('daily_limit', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('emails_sent_today', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('last_reset_date', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='email_provider_settings_pkey')
    )
    op.create_index('ix_email_provider_settings_provider_active', 'email_provider_settings', ['provider', 'is_active'], unique=False)
    op.create_table('events',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('start_time', postgresql.TIME(), autoincrement=False, nullable=True),
    sa.Column('end_time', postgresql.TIME(), autoincrement=False, nullable=True),
    sa.Column('is_all_day', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('event_type', sa.VARCHAR(length=30), server_default=sa.text("'generic'::character varying"), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('visibility', sa.VARCHAR(length=20), server_default=sa.text("'private'::character varying"), autoincrement=False, nullable=False),
    sa.Column('location', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('is_virtual', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('meeting_url', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('is_recurring', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('recurrence_rule', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('parent_event_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('color', sa.VARCHAR(length=7), server_default=sa.text("'#3B82F6'::character varying"), autoincrement=False, nullable=False),
    sa.Column('event_metadata', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), server_default=sa.text("'confirmed'::character varying"), autoincrement=False, nullable=False),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('calendar_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('alert_before_minutes', sa.INTEGER(), server_default=sa.text('2880'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['calendar_id'], ['calendars.id'], name='events_calendar_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['parent_event_id'], ['events.id'], name='events_parent_event_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='events_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_calendar_events_user_id', 'events', ['user_id'], unique=False)
    op.create_index('ix_calendar_events_start_date', 'events', ['start_date'], unique=False)
    op.create_index('ix_calendar_events_calendar_id', 'events', ['calendar_id'], unique=False)
    op.create_table('holidays',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('location_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('is_national', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('is_regional', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('region_code', sa.VARCHAR(length=10), autoincrement=False, nullable=True),
    sa.Column('is_confirmed', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='holidays_pkey'),
    comment='DEPRECATED: Data migrated to calendar.holidays. Use Calendar Service for all holiday operations.'
    )
    op.create_index('ix_holidays_year_type', 'holidays', ['year', 'is_national', 'is_regional'], unique=False)
    op.create_index('ix_config_holidays_year', 'holidays', ['year'], unique=False)
    op.create_index('ix_config_holidays_date_location', 'holidays', ['date', 'location_id'], unique=True)
    op.create_table('national_contract_versions',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('national_contract_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('version_name', sa.VARCHAR(length=100), autoincrement=False, nullable=False, comment='Es: "Rinnovo 2024-2027"'),
    sa.Column('valid_from', sa.DATE(), autoincrement=False, nullable=False, comment='Data inizio validità parametri'),
    sa.Column('valid_to', sa.DATE(), autoincrement=False, nullable=True, comment='Data fine validità (NULL = ancora valido)'),
    sa.Column('weekly_hours_full_time', sa.NUMERIC(precision=4, scale=1), autoincrement=False, nullable=False, comment='Ore settimanali per full time'),
    sa.Column('working_days_per_week', sa.INTEGER(), autoincrement=False, nullable=False, comment='Giorni lavorativi settimanali (5 o 6)'),
    sa.Column('daily_hours', sa.NUMERIC(precision=4, scale=2), autoincrement=False, nullable=False, comment='Ore giornaliere standard'),
    sa.Column('annual_vacation_days', sa.INTEGER(), autoincrement=False, nullable=False, comment='Giorni ferie annuali base'),
    sa.Column('vacation_accrual_method', sa.VARCHAR(length=20), autoincrement=False, nullable=False, comment='Metodo maturazione: monthly, yearly'),
    sa.Column('vacation_carryover_months', sa.INTEGER(), autoincrement=False, nullable=False, comment='Mesi entro cui fruire ferie anno precedente'),
    sa.Column('vacation_carryover_deadline_month', sa.INTEGER(), autoincrement=False, nullable=False, comment='Mese scadenza ferie AP (6 = 30 Giugno)'),
    sa.Column('vacation_carryover_deadline_day', sa.INTEGER(), autoincrement=False, nullable=False, comment='Giorno scadenza ferie AP'),
    sa.Column('annual_rol_hours', sa.INTEGER(), autoincrement=False, nullable=False, comment='Ore ROL annuali (varia per dimensione azienda e anzianità)'),
    sa.Column('rol_accrual_method', sa.VARCHAR(length=20), autoincrement=False, nullable=False, comment='Metodo maturazione ROL'),
    sa.Column('rol_carryover_months', sa.INTEGER(), autoincrement=False, nullable=False, comment='Mesi entro cui fruire ROL anno precedente'),
    sa.Column('annual_ex_festivita_hours', sa.INTEGER(), autoincrement=False, nullable=False, comment='Ore ex-festività annuali (tipicamente 4 giorni x 8h = 32h)'),
    sa.Column('ex_festivita_accrual_method', sa.VARCHAR(length=20), autoincrement=False, nullable=False, comment='Metodo maturazione ex-festività'),
    sa.Column('annual_study_leave_hours', sa.INTEGER(), autoincrement=False, nullable=True, comment='Ore permesso studio annuali'),
    sa.Column('blood_donation_paid_hours', sa.INTEGER(), autoincrement=False, nullable=True, comment='Ore retribuite per donazione sangue (giornata intera)'),
    sa.Column('marriage_leave_days', sa.INTEGER(), autoincrement=False, nullable=True, comment='Giorni permesso matrimonio'),
    sa.Column('bereavement_leave_days', sa.INTEGER(), autoincrement=False, nullable=True, comment='Giorni permesso lutto'),
    sa.Column('l104_monthly_days', sa.INTEGER(), autoincrement=False, nullable=True, comment='Giorni mensili Legge 104'),
    sa.Column('sick_leave_carenza_days', sa.INTEGER(), autoincrement=False, nullable=False, comment='Giorni carenza malattia (retribuiti da azienda, non INPS)'),
    sa.Column('sick_leave_max_days_year', sa.INTEGER(), autoincrement=False, nullable=True, comment='Giorni massimi malattia in comporto'),
    sa.Column('seniority_vacation_bonus', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True, comment='Giorni ferie extra per anzianità: [{"years": 10, "extra_days": 1}, ...]'),
    sa.Column('seniority_rol_bonus', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True, comment='Ore ROL extra per anzianità'),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True, comment='Note e riferimenti normativi'),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('vacation_calc_mode_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('rol_calc_mode_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('vacation_calc_params', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('rol_calc_params', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('count_saturday_as_leave', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['national_contract_id'], ['national_contracts.id'], name='national_contract_versions_national_contract_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['rol_calc_mode_id'], ['calculation_modes.id'], name='national_contract_versions_rol_calc_mode_id_fkey'),
    sa.ForeignKeyConstraint(['vacation_calc_mode_id'], ['calculation_modes.id'], name='national_contract_versions_vacation_calc_mode_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='national_contract_versions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_ncv_contract_valid_from', 'national_contract_versions', ['national_contract_id', 'valid_from'], unique=False)
    op.create_index('ix_config_national_contract_versions_national_contract_id', 'national_contract_versions', ['national_contract_id'], unique=False)
    op.create_table('working_day_exceptions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('exception_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('reason', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('location_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('department_code', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='working_day_exceptions_pkey')
    )
    op.create_index('ix_calendar_working_day_exceptions_year', 'working_day_exceptions', ['year'], unique=False)
    op.create_index('ix_calendar_working_day_exceptions_date', 'working_day_exceptions', ['date'], unique=False)
    op.create_table('leave_balances',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('vacation_previous_year', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_current_year', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_accrued', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_used', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_used_ap', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_used_ac', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('rol_previous_year', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('rol_current_year', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('rol_accrued', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('rol_used', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('permits_total', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('permits_used', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('ap_expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('last_accrual_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='leave_balances_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_leaves_leave_balances_year', 'leave_balances', ['year'], unique=False)
    op.create_index('ix_leaves_leave_balances_user_year', 'leave_balances', ['user_id', 'year'], unique=True)
    op.create_index('ix_leaves_leave_balances_user_id', 'leave_balances', ['user_id'], unique=False)
    op.create_table('system_config',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('key', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('value', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=False),
    sa.Column('value_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('is_sensitive', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='system_config_pkey'),
    sa.UniqueConstraint('key', name='system_config_key_key')
    )
    op.create_index('ix_config_system_config_key', 'system_config', ['key'], unique=True)
    op.create_table('daily_allowance_rules',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('destination_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('full_day_amount', sa.NUMERIC(precision=8, scale=2), autoincrement=False, nullable=False),
    sa.Column('half_day_amount', sa.NUMERIC(precision=8, scale=2), autoincrement=False, nullable=False),
    sa.Column('threshold_hours', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('meals_deduction', sa.NUMERIC(precision=8, scale=2), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='daily_allowance_rules_pkey')
    )
    op.create_table('company_closures',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('closure_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('affected_departments', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('affected_locations', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('is_paid', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('consumes_leave_balance', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('leave_type_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='company_closures_pkey'),
    comment='DEPRECATED: Data migrated to calendar.closures. Use Calendar Service for all closure operations.'
    )
    op.create_index('ix_config_company_closures_year', 'company_closures', ['year'], unique=False)
    op.create_index('ix_config_closures_dates', 'company_closures', ['start_date', 'end_date'], unique=False)
    op.create_table('work_week_profiles',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('weekly_config', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=False),
    sa.Column('total_weekly_hours', sa.NUMERIC(precision=5, scale=2), server_default=sa.text('40.0'), autoincrement=False, nullable=False),
    sa.Column('is_default', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='work_week_profiles_pkey'),
    sa.UniqueConstraint('code', name='work_week_profiles_code_key'),
    postgresql_ignore_search_path=False
    )
    op.create_table('approval_delegations',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('delegator_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('delegate_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('delegation_type', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('scope_team_ids', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('scope_leave_types', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('revoked_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('revoked_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='approval_delegations_pkey')
    )
    op.create_index('ix_leaves_approval_delegations_delegator_id', 'approval_delegations', ['delegator_id'], unique=False)
    op.create_index('ix_leaves_approval_delegations_delegate_id', 'approval_delegations', ['delegate_id'], unique=False)
    op.create_index('ix_approval_delegations_active', 'approval_delegations', ['delegate_id', 'is_active', 'start_date', 'end_date'], unique=False)
    op.create_table('employee_trainings',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('training_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('issue_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('certificate_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('hours', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('provider', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('document_path', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='employee_trainings_user_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='employee_trainings_pkey')
    )
    op.create_index('ix_auth_employee_trainings_user_id', 'employee_trainings', ['user_id'], unique=False)
    op.create_table('closures',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('closure_type', sa.VARCHAR(length=20), server_default=sa.text("'total'::character varying"), autoincrement=False, nullable=False),
    sa.Column('affected_departments', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('affected_locations', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('is_paid', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('consumes_leave_balance', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('leave_type_code', sa.VARCHAR(length=10), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='closures_pkey')
    )
    op.create_index('ix_calendar_closures_year', 'closures', ['year'], unique=False)
    op.create_index('ix_calendar_closures_start_date', 'closures', ['start_date'], unique=False)
    op.create_index('ix_calendar_closures_end_date', 'closures', ['end_date'], unique=False)
    op.create_table('user_roles',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('role_name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('scope', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('granted_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('granted_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='user_roles_user_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='user_roles_pkey')
    )
    op.create_index('ix_auth_user_roles_user_role', 'user_roles', ['user_id', 'role_name'], unique=False)
    op.create_table('approval_requests',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('entity_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('entity_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('entity_ref', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('workflow_config_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('requester_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('requester_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('title', sa.VARCHAR(length=300), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('request_metadata', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('callback_url', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=30), server_default=sa.text("'PENDING'::character varying"), autoincrement=False, nullable=False),
    sa.Column('required_approvals', sa.INTEGER(), server_default=sa.text('1'), autoincrement=False, nullable=False),
    sa.Column('received_approvals', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('received_rejections', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('current_level', sa.INTEGER(), server_default=sa.text('1'), autoincrement=False, nullable=True),
    sa.Column('max_level', sa.INTEGER(), server_default=sa.text('1'), autoincrement=False, nullable=True),
    sa.Column('expires_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('expired_action_taken', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('resolved_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('resolution_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('final_decision_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['workflow_config_id'], ['workflow_configs.id'], name='fk_request_workflow'),
    sa.PrimaryKeyConstraint('id', name='approval_requests_pkey'),
    sa.UniqueConstraint('entity_type', 'entity_id', name='uq_entity_request'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_approvals_approval_requests_status', 'approval_requests', ['status'], unique=False)
    op.create_index('ix_approvals_approval_requests_requester_id', 'approval_requests', ['requester_id'], unique=False)
    op.create_index('ix_approvals_approval_requests_expires_at', 'approval_requests', ['expires_at'], unique=False)
    op.create_index('ix_approvals_approval_requests_entity_type', 'approval_requests', ['entity_type'], unique=False)
    op.create_index('idx_approval_requests_pending_expires', 'approval_requests', ['expires_at'], unique=False, postgresql_where="((status)::text = 'PENDING'::text)")
    op.create_table('departments',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('parent_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('hierarchy_level', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('manager_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('deputy_manager_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('cost_center_code', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['deputy_manager_id'], ['users.id'], name='departments_deputy_manager_id_fkey'),
    sa.ForeignKeyConstraint(['manager_id'], ['users.id'], name='departments_manager_id_fkey'),
    sa.ForeignKeyConstraint(['parent_id'], ['departments.id'], name='departments_parent_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='departments_pkey'),
    sa.UniqueConstraint('code', name='departments_code_key'),
    postgresql_ignore_search_path=False
    )
    op.create_table('user_profiles',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('phone', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('department', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('position', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('hire_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('contract_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('weekly_hours', sa.NUMERIC(precision=4, scale=1), autoincrement=False, nullable=True),
    sa.Column('manager_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('employee_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('location', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('avatar_url', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['manager_id'], ['users.id'], name='user_profiles_manager_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='user_profiles_user_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='user_profiles_pkey'),
    sa.UniqueConstraint('employee_number', name='user_profiles_employee_number_key'),
    sa.UniqueConstraint('user_id', name='user_profiles_user_id_key')
    )
    op.create_table('audit_trail_archive',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('entity_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('entity_id', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('version', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('operation', sa.VARCHAR(length=10), autoincrement=False, nullable=False),
    sa.Column('before_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('after_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('changed_fields', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('changed_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('changed_by_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('changed_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=False),
    sa.Column('change_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('service_name', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('request_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('archived_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='audit_trail_archive_pkey')
    )
    op.create_index('ix_audit_trail_archive_changed', 'audit_trail_archive', ['changed_at'], unique=False)
    op.create_table('policy_rules',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('rule_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('conditions', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=False),
    sa.Column('actions', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=False),
    sa.Column('priority', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='policy_rules_pkey')
    )
    op.create_table('national_contracts',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('sector', sa.VARCHAR(length=100), autoincrement=False, nullable=True, comment='Settore economico (Commercio, Metalmeccanico, etc.)'),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('source_url', sa.TEXT(), autoincrement=False, nullable=True, comment='Link al testo ufficiale del CCNL'),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='national_contracts_pkey'),
    sa.UniqueConstraint('code', name='national_contracts_code_key'),
    postgresql_ignore_search_path=False
    )
    op.create_table('role_permissions',
    sa.Column('role_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('permission_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('scope', sa.VARCHAR(), server_default=sa.text("'GLOBAL'::character varying"), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['permission_id'], ['permissions.id'], name='role_permissions_permission_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], name='role_permissions_role_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('role_id', 'permission_id', 'scope', name='role_permissions_pkey')
    )
    op.create_table('permissions',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('resource', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('action', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='permissions_pkey'),
    sa.UniqueConstraint('code', name='permissions_code_key')
    )
    op.create_table('areas',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('parent_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('manager_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['manager_id'], ['users.id'], name='areas_manager_id_fkey'),
    sa.ForeignKeyConstraint(['parent_id'], ['areas.id'], name='areas_parent_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='areas_pkey'),
    sa.UniqueConstraint('code', name='areas_code_key'),
    postgresql_ignore_search_path=False
    )
    op.create_table('safety_compliance',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('employee_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('is_compliant', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=True),
    sa.Column('compliance_score', sa.INTEGER(), server_default=sa.text('100'), autoincrement=False, nullable=True),
    sa.Column('has_formazione_generale', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('has_formazione_specifica', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('trainings_expiring_soon', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('trainings_expired', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('medical_fitness_valid', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('medical_next_visit', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('medical_restrictions', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('last_check_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('issues', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='safety_compliance_pkey'),
    sa.UniqueConstraint('employee_id', name='safety_compliance_employee_id_key')
    )
    op.create_index('ix_safety_compliance_is_compliant', 'safety_compliance', ['is_compliant'], unique=False)
    op.create_index('ix_safety_compliance_employee_id', 'safety_compliance', ['employee_id'], unique=False)
    op.create_table('leave_types',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=10), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('scales_balance', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('balance_type', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('requires_approval', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('requires_attachment', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('requires_protocol', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('min_notice_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('max_consecutive_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('max_per_month', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('allow_past_dates', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('allow_half_day', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('allow_negative_balance', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('color', sa.VARCHAR(length=7), autoincrement=False, nullable=False),
    sa.Column('icon', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('sort_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('max_single_request_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='leave_types_pkey'),
    sa.UniqueConstraint('code', name='leave_types_code_key')
    )
    op.create_table('expense_items',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('report_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('expense_type_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('expense_type_code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(length=500), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), autoincrement=False, nullable=False),
    sa.Column('exchange_rate', sa.NUMERIC(precision=10, scale=6), autoincrement=False, nullable=False),
    sa.Column('amount_eur', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=False),
    sa.Column('km_distance', sa.NUMERIC(precision=7, scale=2), autoincrement=False, nullable=True),
    sa.Column('km_rate', sa.NUMERIC(precision=5, scale=3), autoincrement=False, nullable=True),
    sa.Column('merchant_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('receipt_number', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('receipt_path', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['report_id'], ['expense_reports.id'], name='expense_items_report_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='expense_items_pkey')
    )
    op.create_index('ix_expenses_expense_items_report', 'expense_items', ['report_id'], unique=False)
    op.create_table('trip_wallets',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('trip_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('total_budget', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('total_advances', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('total_expenses', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('total_taxable', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('total_non_taxable', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), server_default=sa.text("'EUR'::character varying"), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), server_default=sa.text("'OPEN'::character varying"), autoincrement=False, nullable=False),
    sa.Column('policy_violations_count', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('is_reconciled', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='trip_wallets_pkey'),
    sa.UniqueConstraint('trip_id', name='trip_wallets_trip_id_key'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_wallet_trip_wallets_user_id', 'trip_wallets', ['user_id'], unique=False)
    op.create_index('ix_wallet_trip_wallets_trip_id', 'trip_wallets', ['trip_id'], unique=True)
    op.create_table('balance_reservations',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('leave_request_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('balance_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('breakdown', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('confirmed_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('cancelled_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('expires_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['leave_request_id'], ['leave_requests.id'], name='balance_reservations_leave_request_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='balance_reservations_pkey'),
    sa.UniqueConstraint('leave_request_id', name='balance_reservations_leave_request_id_key')
    )
    op.create_index('ix_leaves_balance_reservations_user_id', 'balance_reservations', ['user_id'], unique=False)
    op.create_index('ix_balance_reservations_pending', 'balance_reservations', ['user_id', 'status'], unique=False)
    op.create_table('national_contract_levels',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('national_contract_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('level_name', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('sort_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['national_contract_id'], ['national_contracts.id'], name='national_contract_levels_national_contract_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='national_contract_levels_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_ncl_contract_id', 'national_contract_levels', ['national_contract_id'], unique=False)
    op.create_table('calculation_modes',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('function_name', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('default_parameters', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='calculation_modes_pkey'),
    sa.UniqueConstraint('code', name='calculation_modes_code_key'),
    postgresql_ignore_search_path=False
    )
    op.create_table('expense_reports',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('trip_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('report_number', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('period_start', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('period_end', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('total_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=False),
    sa.Column('approved_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('employee_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('approver_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('approver_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('approved_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('attachment_path', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('paid_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('payment_reference', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('is_standalone', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['trip_id'], ['business_trips.id'], name='expense_reports_trip_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='expense_reports_pkey'),
    sa.UniqueConstraint('report_number', name='expense_reports_report_number_key'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_expenses_expense_reports_user_id', 'expense_reports', ['user_id'], unique=False)
    op.create_index('ix_expenses_expense_reports_status', 'expense_reports', ['status'], unique=False)
    op.create_table('event_participants',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('event_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('response_status', sa.VARCHAR(length=20), server_default=sa.text("'pending'::character varying"), autoincrement=False, nullable=False),
    sa.Column('is_organizer', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('is_optional', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('responded_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['event_id'], ['events.id'], name='event_participants_event_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='event_participants_pkey'),
    sa.UniqueConstraint('event_id', 'user_id', name='uq_event_participant')
    )
    op.create_index('ix_calendar_event_participants_user_id', 'event_participants', ['user_id'], unique=False)
    op.create_index('ix_calendar_event_participants_event_id', 'event_participants', ['event_id'], unique=False)
    op.create_table('users',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('keycloak_id', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('email', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('username', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('first_name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('last_name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('is_synced', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('last_login', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('badge_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('fiscal_code', sa.VARCHAR(length=16), autoincrement=False, nullable=True),
    sa.Column('hire_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('termination_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('work_schedule_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('location_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('manager_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('is_admin', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('is_manager', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('is_approver', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('last_sync_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('contract_type_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('is_hr', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('is_employee', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('department_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('service_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('executive_level_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('mfa_enabled', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['contract_type_id'], ['contract_types.id'], name='users_contract_type_id_fkey'),
    sa.ForeignKeyConstraint(['department_id'], ['departments.id'], name='users_department_id_fkey'),
    sa.ForeignKeyConstraint(['executive_level_id'], ['executive_levels.id'], name='users_executive_level_id_fkey'),
    sa.ForeignKeyConstraint(['location_id'], ['locations.id'], name='users_location_id_fkey'),
    sa.ForeignKeyConstraint(['manager_id'], ['users.id'], name='users_manager_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['service_id'], ['organizational_services.id'], name='users_service_id_fkey'),
    sa.ForeignKeyConstraint(['work_schedule_id'], ['work_schedules.id'], name='users_work_schedule_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='users_pkey'),
    sa.UniqueConstraint('username', name='users_username_key'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_auth_users_keycloak_id', 'users', ['keycloak_id'], unique=True)
    op.create_index('ix_auth_users_email', 'users', ['email'], unique=True)
    op.create_table('medical_records',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('employee_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('visit_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('visit_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('next_visit_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('fitness_result', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('restrictions', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('doctor_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('document_path', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('recorded_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='medical_records_pkey')
    )
    op.create_index('ix_medical_records_next_visit_date', 'medical_records', ['next_visit_date'], unique=False)
    op.create_index('ix_medical_records_employee_id', 'medical_records', ['employee_id'], unique=False)
    op.create_table('signature_transactions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('actor_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('document_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('document_id', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('document_hash', sa.VARCHAR(length=64), autoincrement=False, nullable=False),
    sa.Column('document_version', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('signature_method', sa.VARCHAR(length=20), server_default=sa.text("'MFA_TOTP'::character varying"), autoincrement=False, nullable=False),
    sa.Column('provider', sa.VARCHAR(length=20), server_default=sa.text("'KEYCLOAK'::character varying"), autoincrement=False, nullable=False),
    sa.Column('otp_verified', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('ip_address', sa.VARCHAR(length=45), autoincrement=False, nullable=True),
    sa.Column('user_agent', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('device_info', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('signed_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='signature_transactions_pkey'),
    schema='signature'
    )
    op.create_index('ix_signature_signature_transactions_user_id', 'signature_transactions', ['user_id'], unique=False, schema='signature')
    op.create_index('ix_signature_signature_transactions_document_type', 'signature_transactions', ['document_type'], unique=False, schema='signature')
    op.create_index('ix_signature_signature_transactions_document_id', 'signature_transactions', ['document_id'], unique=False, schema='signature')
    op.create_table('employee_monthly_stats',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('employee_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('month', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('vacation_days_taken', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('vacation_hours_taken', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('rol_days_taken', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('rol_hours_taken', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('permit_hours_taken', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('sick_days', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('sick_hours', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('other_absence_days', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('vacation_balance_ap', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('vacation_balance_ac', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('rol_balance', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('permit_balance', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('trips_count', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('trips_total_days', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('expenses_total', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('allowances_total', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('payroll_codes', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('details', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='employee_monthly_stats_pkey')
    )
    op.create_index('ix_hr_reporting_employee_monthly_stats_employee_id', 'employee_monthly_stats', ['employee_id'], unique=False)
    op.create_index('ix_employee_monthly_stats_period', 'employee_monthly_stats', ['employee_id', 'year', 'month'], unique=True)
    op.create_table('expense_ledger',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('trip_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('entry_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(length=30), autoincrement=False, nullable=True),
    sa.Column('amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), autoincrement=False, nullable=True),
    sa.Column('is_taxable', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('vat_rate', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('vat_amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=True),
    sa.Column('is_reimbursable', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('has_receipt', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('compliance_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('reference_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('reference_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('reference_status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.CheckConstraint('amount >= 0::numeric', name='ck_expense_ledger_amount_positive'),
    sa.PrimaryKeyConstraint('id', name='expense_ledger_pkey'),
    schema='expenses'
    )
    op.create_index('ix_expenses_expense_ledger_user_id', 'expense_ledger', ['user_id'], unique=False, schema='expenses')
    op.create_index('ix_expenses_expense_ledger_trip_id', 'expense_ledger', ['trip_id'], unique=False, schema='expenses')
    op.create_index('ix_expense_ledger_trip', 'expense_ledger', ['trip_id'], unique=False, schema='expenses')
    op.create_index('ix_expense_ledger_reference', 'expense_ledger', ['reference_type', 'reference_id'], unique=False, schema='expenses')
    op.create_table('audit_logs_archive',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('user_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('action', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('resource_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('resource_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('request_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('response_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('ip_address', postgresql.INET(), autoincrement=False, nullable=True),
    sa.Column('user_agent', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('endpoint', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('http_method', sa.VARCHAR(length=10), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('error_message', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('service_name', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=False),
    sa.Column('archived_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='audit_logs_archive_pkey')
    )
    op.create_index('ix_audit_logs_archive_created', 'audit_logs_archive', ['created_at'], unique=False)
    op.create_table('user_notification_preferences',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('email_enabled', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('in_app_enabled', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('digest_frequency', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('push_enabled', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('preferences_matrix', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='user_notification_preferences_pkey'),
    sa.UniqueConstraint('user_id', name='user_notification_preferences_user_id_key')
    )
    op.create_table('daily_allowances',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('trip_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('is_full_day', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('breakfast_provided', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('lunch_provided', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('dinner_provided', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('base_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=False),
    sa.Column('meals_deduction', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=False),
    sa.Column('final_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=False),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['trip_id'], ['business_trips.id'], name='daily_allowances_trip_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='daily_allowances_pkey')
    )
    op.create_index('ix_expenses_daily_allowances_trip_date', 'daily_allowances', ['trip_id', 'date'], unique=True)
    op.create_table('employee_wallets',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('vacation_previous_year', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_current_year', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_accrued', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_used', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_used_ap', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_used_ac', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('rol_previous_year', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('rol_current_year', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('rol_accrued', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('rol_used', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('permits_total', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('permits_used', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('ap_expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('last_accrual_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('legal_minimum_required', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'20'::numeric"), autoincrement=False, nullable=False),
    sa.Column('legal_minimum_taken', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('hourly_rate_snapshot', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), server_default=sa.text("'ACTIVE'::character varying"), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='employee_wallets_pkey'),
    schema='leaves',
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_time_wallet_employee_wallets_user_id', 'employee_wallets', ['user_id'], unique=False, schema='leaves')
    op.create_table('email_logs',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('to_email', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('to_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('template_code', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('subject', sa.VARCHAR(length=300), autoincrement=False, nullable=True),
    sa.Column('variables', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('message_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('notification_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('retry_count', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('next_retry_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('provider_response', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('sent_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('delivered_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('opened_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('clicked_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('bounced_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('failed_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='email_logs_pkey')
    )
    op.create_index('ix_notifications_email_logs_user_id', 'email_logs', ['user_id'], unique=False)
    op.create_index('ix_notifications_email_logs_to_email', 'email_logs', ['to_email'], unique=False)
    op.create_index('ix_notifications_email_logs_template_code', 'email_logs', ['template_code'], unique=False)
    op.create_index('ix_notifications_email_logs_status', 'email_logs', ['status'], unique=False)
    op.create_index('ix_notifications_email_logs_message_id', 'email_logs', ['message_id'], unique=False)
    op.create_index('ix_email_logs_created_at', 'email_logs', ['created_at'], unique=False)
    op.create_table('notifications',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_email', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('notification_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('message', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('channel', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('sent_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('read_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('entity_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('entity_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('action_url', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('retry_count', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='notifications_pkey')
    )
    op.create_index('ix_notifications_notifications_user_id', 'notifications', ['user_id'], unique=False)
    op.create_index('ix_notifications_notifications_notification_type', 'notifications', ['notification_type'], unique=False)
    op.create_table('report_attachments',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('report_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('file_path', sa.VARCHAR(length=500), autoincrement=False, nullable=False),
    sa.Column('filename', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('content_type', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('size_bytes', sa.BIGINT(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['report_id'], ['expense_reports.id'], name='report_attachments_report_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='report_attachments_pkey')
    )
    op.create_table('generated_reports',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('report_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('period_start', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('period_end', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('department_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('team_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), server_default=sa.text("'pending'::character varying"), autoincrement=False, nullable=True),
    sa.Column('report_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('summary', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('generated_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('generated_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('pdf_path', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('excel_path', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='generated_reports_pkey')
    )
    op.create_index('ix_hr_reporting_generated_reports_report_type', 'generated_reports', ['report_type'], unique=False)
    op.create_index('ix_generated_reports_period', 'generated_reports', ['report_type', 'period_start', 'department_id'], unique=False)
    op.create_table('balance_transactions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('balance_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('leave_request_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('transaction_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('balance_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('balance_after', sa.NUMERIC(precision=7, scale=2), autoincrement=False, nullable=False),
    sa.Column('reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('remaining_amount', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['balance_id'], ['leaves.leave_balances.id'], name='balance_transactions_balance_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['leave_request_id'], ['leaves.leave_requests.id'], name='balance_transactions_leave_request_id_fkey', ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id', name='balance_transactions_pkey'),
    schema='leaves'
    )
    op.create_index('ix_leaves_balance_transactions_balance', 'balance_transactions', ['balance_id'], unique=False, schema='leaves')
    op.create_table('national_contract_type_configs',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('national_contract_version_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('contract_type_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('weekly_hours', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('annual_vacation_days', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('annual_rol_hours', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('annual_ex_festivita_hours', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['contract_type_id'], ['contract_types.id'], name='national_contract_type_configs_contract_type_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['national_contract_version_id'], ['national_contract_versions.id'], name='national_contract_type_config_national_contract_version_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='national_contract_type_configs_pkey'),
    sa.UniqueConstraint('national_contract_version_id', 'contract_type_id', name='uq_nc_version_contract_type')
    )
    op.create_index('ix_nctc_version_id', 'national_contract_type_configs', ['national_contract_version_id'], unique=False)
    op.create_table('trip_wallet_transactions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('wallet_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('transaction_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(length=30), autoincrement=False, nullable=True),
    sa.Column('tax_rate', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('tax_amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=True),
    sa.Column('is_reimbursable', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('is_taxable', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('has_receipt', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('compliance_flags', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('reference_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['wallet_id'], ['expenses.trip_wallets.id'], name='trip_wallet_transactions_wallet_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='trip_wallet_transactions_pkey'),
    schema='expenses'
    )
    op.create_table('locations',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('address', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('city', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('province', sa.VARCHAR(length=2), autoincrement=False, nullable=True),
    sa.Column('patron_saint_name', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('patron_saint_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='locations_pkey'),
    sa.UniqueConstraint('code', name='locations_code_key'),
    postgresql_ignore_search_path=False
    )
    op.create_table('alembic_version',
    sa.Column('version_num', sa.VARCHAR(length=32), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('version_num', name='alembic_version_pkc')
    )
    op.create_table('calendar_shares',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('calendar_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('permission', postgresql.ENUM('READ', 'WRITE', 'ADMIN', name='calendarpermission'), server_default=sa.text("'READ'::calendarpermission"), autoincrement=False, nullable=False),
    sa.Column('is_mandatory', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['calendar_id'], ['calendars.id'], name='calendar_shares_calendar_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='calendar_shares_pkey'),
    sa.UniqueConstraint('calendar_id', 'user_id', name='uq_calendar_share_user')
    )
    op.create_index('ix_calendar_calendar_shares_user_id', 'calendar_shares', ['user_id'], unique=False)
    op.create_table('user_areas',
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('area_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['area_id'], ['areas.id'], name='user_areas_area_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='user_areas_user_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('user_id', 'area_id', name='user_areas_pkey')
    )
    op.create_table('employee_contracts',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('contract_type_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('weekly_hours', sa.INTEGER(), autoincrement=False, nullable=True, comment='Ore settimanali effettive'),
    sa.Column('job_title', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('department', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('wage_data', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('document_path', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('national_contract_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('level_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['level_id'], ['national_contract_levels.id'], name='fk_employee_contracts_level'),
    sa.ForeignKeyConstraint(['national_contract_id'], ['national_contracts.id'], name='fk_employee_contracts_national_contract'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='employee_contracts_user_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='employee_contracts_pkey')
    )
    op.create_index('ix_auth_employee_contracts_user_id', 'employee_contracts', ['user_id'], unique=False)
    op.create_table('wallet_transactions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('wallet_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('reference_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('transaction_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('balance_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('balance_after', sa.NUMERIC(precision=7, scale=2), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('remaining_amount', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('category', sa.VARCHAR(length=30), autoincrement=False, nullable=True),
    sa.Column('monetary_value', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=True),
    sa.Column('exchange_rate_to_hours', sa.NUMERIC(precision=10, scale=4), autoincrement=False, nullable=True),
    sa.Column('is_confirmed', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('meta_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['wallet_id'], ['leaves.employee_wallets.id'], name='wallet_transactions_wallet_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='wallet_transactions_pkey'),
    schema='leaves'
    )
    op.create_table('approval_reminders',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('approval_request_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('approver_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('reminder_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('scheduled_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=False),
    sa.Column('sent_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('is_sent', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['approval_request_id'], ['approval_requests.id'], name='fk_reminder_request', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='approval_reminders_pkey')
    )
    op.create_index('ix_approvals_approval_reminders_scheduled_at', 'approval_reminders', ['scheduled_at'], unique=False)
    op.create_table('audit_trail_archive',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('entity_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('entity_id', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('version', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('operation', sa.VARCHAR(length=10), autoincrement=False, nullable=False),
    sa.Column('before_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('after_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('changed_fields', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('changed_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('changed_by_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('changed_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=False),
    sa.Column('change_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('service_name', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('request_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('archived_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='audit_trail_archive_pkey'),
    schema='audit'
    )
    op.create_index('ix_audit_trail_archive_changed', 'audit_trail_archive', ['changed_at'], unique=False, schema='audit')
    op.create_table('trip_wallets',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('trip_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('total_budget', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('total_advances', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('total_expenses', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('total_taxable', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('total_non_taxable', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), server_default=sa.text("'EUR'::character varying"), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), server_default=sa.text("'OPEN'::character varying"), autoincrement=False, nullable=False),
    sa.Column('policy_violations_count', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('is_reconciled', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='trip_wallets_pkey'),
    sa.UniqueConstraint('trip_id', name='trip_wallets_trip_id_key'),
    schema='expenses'
    )
    op.create_index('ix_wallet_trip_wallets_user_id', 'trip_wallets', ['user_id'], unique=False, schema='expenses')
    op.create_index('ix_wallet_trip_wallets_trip_id', 'trip_wallets', ['trip_id'], unique=True, schema='expenses')
    op.create_table('daily_snapshots',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('snapshot_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('total_employees', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('employees_on_leave', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('employees_on_trip', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('employees_sick', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('absence_rate', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('pending_leave_requests', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('approved_leave_today', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('pending_expense_reports', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('total_expenses_submitted', sa.NUMERIC(precision=12, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=True),
    sa.Column('details', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='daily_snapshots_pkey')
    )
    op.create_index('ix_hr_reporting_daily_snapshots_snapshot_date', 'daily_snapshots', ['snapshot_date'], unique=True)
    op.create_table('leave_request_history',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('leave_request_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('from_status', sa.VARCHAR(length=30), autoincrement=False, nullable=True),
    sa.Column('to_status', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('changed_by', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('changed_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['leave_request_id'], ['leave_requests.id'], name='leave_request_history_leave_request_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='leave_request_history_pkey')
    )
    op.create_index('ix_leaves_leave_request_history_request', 'leave_request_history', ['leave_request_id'], unique=False)
    op.create_table('trip_attachments',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('trip_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('file_path', sa.VARCHAR(length=500), autoincrement=False, nullable=False),
    sa.Column('filename', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('content_type', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('size_bytes', sa.BIGINT(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['trip_id'], ['business_trips.id'], name='trip_attachments_trip_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='trip_attachments_pkey')
    )
    op.create_table('time_ledger',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('entry_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('balance_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('reference_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('reference_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('reference_status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.CheckConstraint('amount >= 0::numeric', name='ck_time_ledger_amount_positive'),
    sa.PrimaryKeyConstraint('id', name='time_ledger_pkey'),
    schema='leaves'
    )
    op.create_index('ix_time_ledger_user_year_type', 'time_ledger', ['user_id', 'year', 'balance_type'], unique=False, schema='leaves')
    op.create_index('ix_time_ledger_reference', 'time_ledger', ['reference_type', 'reference_id'], unique=False, schema='leaves')
    op.create_index('ix_leaves_time_ledger_user_id', 'time_ledger', ['user_id'], unique=False, schema='leaves')
    op.create_table('email_templates',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('brevo_template_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('subject', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('html_content', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('text_content', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('notification_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('available_variables', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='email_templates_pkey'),
    sa.UniqueConstraint('code', name='email_templates_code_key')
    )
    op.create_table('leave_balances',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('vacation_previous_year', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_current_year', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_accrued', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_used', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_used_ap', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('vacation_used_ac', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('rol_previous_year', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('rol_current_year', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('rol_accrued', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('rol_used', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('permits_total', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('permits_used', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('ap_expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('last_accrual_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='leave_balances_pkey'),
    schema='leaves'
    )
    op.create_index('ix_leaves_leave_balances_year', 'leave_balances', ['year'], unique=False, schema='leaves')
    op.create_index('ix_leaves_leave_balances_user_year', 'leave_balances', ['user_id', 'year'], unique=True, schema='leaves')
    op.create_index('ix_leaves_leave_balances_user_id', 'leave_balances', ['user_id'], unique=False, schema='leaves')
    op.create_table('calendars',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('type', postgresql.ENUM('SYSTEM', 'LOCATION', 'PERSONAL', 'TEAM', name='calendartype'), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('color', sa.VARCHAR(length=7), server_default=sa.text("'#4F46E5'::character varying"), autoincrement=False, nullable=False),
    sa.Column('owner_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('is_system', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('visibility', sa.VARCHAR(length=20), server_default=sa.text("'private'::character varying"), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='calendars_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_calendar_calendars_owner_id', 'calendars', ['owner_id'], unique=False)
    op.create_table('push_subscriptions',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('endpoint', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('p256dh', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('auth', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('device_info', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='push_subscriptions_pkey')
    )
    op.create_index('ix_push_subscriptions_endpoint', 'push_subscriptions', ['endpoint'], unique=False)
    op.create_index('ix_notifications_push_subscriptions_user_id', 'push_subscriptions', ['user_id'], unique=False)
    op.create_table('audit_logs',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('user_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('action', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('resource_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('resource_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('request_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('response_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('ip_address', postgresql.INET(), autoincrement=False, nullable=True),
    sa.Column('user_agent', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('endpoint', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('http_method', sa.VARCHAR(length=10), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('error_message', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('service_name', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='audit_logs_pkey')
    )
    op.create_index('ix_audit_logs_user_id', 'audit_logs', ['user_id'], unique=False)
    op.create_index('ix_audit_logs_resource', 'audit_logs', ['resource_type', 'resource_id'], unique=False)
    op.create_index('ix_audit_logs_created_at', 'audit_logs', ['created_at'], unique=False)
    op.create_index('ix_audit_logs_admin_query', 'audit_logs', ['service_name', 'action', 'status', 'created_at'], unique=False)
    op.create_table('training_records',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('employee_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('training_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('training_name', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('provider_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('provider_code', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('training_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('hours', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), server_default=sa.text("'valido'::character varying"), autoincrement=False, nullable=True),
    sa.Column('certificate_number', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('certificate_path', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('recorded_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='training_records_pkey')
    )
    op.create_index('ix_training_records_training_type', 'training_records', ['training_type'], unique=False)
    op.create_index('ix_training_records_status', 'training_records', ['status'], unique=False)
    op.create_index('ix_training_records_expiry_date', 'training_records', ['expiry_date'], unique=False)
    op.create_index('ix_training_records_employee_id', 'training_records', ['employee_id'], unique=False)
    op.create_table('audit_trail',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('entity_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('entity_id', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('version', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('operation', sa.VARCHAR(length=10), autoincrement=False, nullable=False),
    sa.Column('before_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('after_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('changed_fields', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('changed_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('changed_by_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('changed_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('change_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('service_name', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('request_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='audit_trail_pkey')
    )
    op.create_index('ix_audit_trail_entity', 'audit_trail', ['entity_type', 'entity_id'], unique=False)
    op.create_index('ix_audit_trail_changed_by', 'audit_trail', ['changed_by'], unique=False)
    op.create_index('ix_audit_trail_changed_at', 'audit_trail', ['changed_at'], unique=False)
    op.create_table('expense_ledger',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('trip_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('entry_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(length=30), autoincrement=False, nullable=True),
    sa.Column('amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), autoincrement=False, nullable=True),
    sa.Column('is_taxable', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('vat_rate', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('vat_amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=True),
    sa.Column('is_reimbursable', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('has_receipt', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('compliance_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('reference_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('reference_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('reference_status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.CheckConstraint('amount >= 0::numeric', name='ck_expense_ledger_amount_positive'),
    sa.PrimaryKeyConstraint('id', name='expense_ledger_pkey')
    )
    op.create_index('ix_expenses_expense_ledger_user_id', 'expense_ledger', ['user_id'], unique=False)
    op.create_index('ix_expenses_expense_ledger_trip_id', 'expense_ledger', ['trip_id'], unique=False)
    op.create_index('ix_expense_ledger_trip', 'expense_ledger', ['trip_id'], unique=False)
    op.create_index('ix_expense_ledger_reference', 'expense_ledger', ['reference_type', 'reference_id'], unique=False)
    op.create_table('employee_wallets',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('vacation_previous_year', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_current_year', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_accrued', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_used', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_used_ap', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('vacation_used_ac', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('rol_previous_year', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('rol_current_year', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('rol_accrued', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('rol_used', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('permits_total', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('permits_used', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('ap_expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('last_accrual_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('legal_minimum_required', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'20'::numeric"), autoincrement=False, nullable=False),
    sa.Column('legal_minimum_taken', sa.NUMERIC(precision=5, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('hourly_rate_snapshot', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), server_default=sa.text("'ACTIVE'::character varying"), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='employee_wallets_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_time_wallet_employee_wallets_user_id', 'employee_wallets', ['user_id'], unique=False)
    op.create_table('approval_history',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('approval_request_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('action', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('actor_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('actor_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('actor_type', sa.VARCHAR(length=30), autoincrement=False, nullable=True),
    sa.Column('details', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['approval_request_id'], ['approval_requests.id'], name='fk_history_request', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='approval_history_pkey')
    )
    op.create_index('ix_approvals_approval_history_approval_request_id', 'approval_history', ['approval_request_id'], unique=False)
    op.create_table('holiday_profiles',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('calendar_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('code', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('country_code', sa.VARCHAR(length=2), autoincrement=False, nullable=True),
    sa.Column('region_code', sa.VARCHAR(length=10), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['calendar_id'], ['calendars.id'], name='holiday_profiles_calendar_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='holiday_profiles_pkey'),
    sa.UniqueConstraint('calendar_id', name='holiday_profiles_calendar_id_key'),
    sa.UniqueConstraint('code', name='holiday_profiles_code_key')
    )
    op.create_table('balance_transactions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('balance_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('leave_request_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('transaction_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('balance_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('balance_after', sa.NUMERIC(precision=7, scale=2), autoincrement=False, nullable=False),
    sa.Column('reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('remaining_amount', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['balance_id'], ['leave_balances.id'], name='balance_transactions_balance_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['leave_request_id'], ['leave_requests.id'], name='balance_transactions_leave_request_id_fkey', ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id', name='balance_transactions_pkey')
    )
    op.create_index('ix_leaves_balance_transactions_balance', 'balance_transactions', ['balance_id'], unique=False)
    op.create_table('audit_logs_archive',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('user_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('action', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('resource_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('resource_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('request_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('response_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('ip_address', postgresql.INET(), autoincrement=False, nullable=True),
    sa.Column('user_agent', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('endpoint', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('http_method', sa.VARCHAR(length=10), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('error_message', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('service_name', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=False),
    sa.Column('archived_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='audit_logs_archive_pkey'),
    schema='audit'
    )
    op.create_index('ix_audit_logs_archive_created', 'audit_logs_archive', ['created_at'], unique=False, schema='audit')
    op.create_table('contract_types',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('is_part_time', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('part_time_percentage', sa.DOUBLE_PRECISION(precision=53), server_default=sa.text("'100'::double precision"), autoincrement=False, nullable=False),
    sa.Column('annual_vacation_days', sa.INTEGER(), server_default=sa.text('26'), autoincrement=False, nullable=False),
    sa.Column('annual_rol_hours', sa.INTEGER(), server_default=sa.text('72'), autoincrement=False, nullable=False),
    sa.Column('annual_permit_hours', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('national_contract_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['national_contract_id'], ['national_contracts.id'], name='fk_contract_types_national_contract', ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id', name='contract_types_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_config_contract_types_code', 'contract_types', ['code'], unique=True)
    op.create_table('trip_wallet_transactions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('wallet_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('transaction_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(length=30), autoincrement=False, nullable=True),
    sa.Column('tax_rate', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('tax_amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=True),
    sa.Column('is_reimbursable', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('is_taxable', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('has_receipt', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('compliance_flags', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('reference_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['wallet_id'], ['trip_wallets.id'], name='trip_wallet_transactions_wallet_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='trip_wallet_transactions_pkey')
    )
    op.create_table('location_calendars',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('location_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('work_week_profile_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('timezone', sa.VARCHAR(length=50), server_default=sa.text("'Europe/Rome'::character varying"), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['work_week_profile_id'], ['work_week_profiles.id'], name='location_calendars_work_week_profile_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='location_calendars_pkey'),
    sa.UniqueConstraint('location_id', name='uq_location_calendar')
    )
    op.create_index('ix_calendar_location_calendars_location_id', 'location_calendars', ['location_id'], unique=False)
    op.create_table('approval_decisions',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('approval_request_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('approver_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('approver_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('approver_role', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('approval_level', sa.INTEGER(), server_default=sa.text('1'), autoincrement=False, nullable=True),
    sa.Column('decision', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('decision_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('delegated_to_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('delegated_to_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('assigned_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('decided_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['approval_request_id'], ['approval_requests.id'], name='fk_decision_request', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='approval_decisions_pkey'),
    sa.UniqueConstraint('approval_request_id', 'approver_id', name='uq_approver_request')
    )
    op.create_index('ix_approvals_approval_decisions_approver_id', 'approval_decisions', ['approver_id'], unique=False)
    op.create_index('idx_approval_decisions_pending', 'approval_decisions', ['approval_request_id'], unique=False, postgresql_where='(decided_at IS NULL)')
    op.create_table('leave_interruptions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('leave_request_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('interruption_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('specific_days', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('days_refunded', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('protocol_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('attachment_path', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('initiated_by', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('initiated_by_role', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('refund_transaction_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['leave_request_id'], ['leave_requests.id'], name='leave_interruptions_leave_request_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='leave_interruptions_pkey')
    )
    op.create_index('ix_leaves_leave_interruptions_leave_request_id', 'leave_interruptions', ['leave_request_id'], unique=False)
    op.create_index('ix_leave_interruptions_type', 'leave_interruptions', ['interruption_type', 'status'], unique=False)
    op.create_table('business_trips',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('destination', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('destination_type', sa.VARCHAR(length=20), server_default=sa.text("'national'::character varying"), autoincrement=False, nullable=False),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('purpose', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('project_code', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('client_name', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('estimated_budget', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=30), server_default=sa.text("'draft'::character varying"), autoincrement=False, nullable=False),
    sa.Column('approver_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('approved_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('approver_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('attachment_path', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='business_trips_pkey')
    )
    op.create_index('ix_expenses_business_trips_user_id', 'business_trips', ['user_id'], unique=False)
    op.create_index('ix_expenses_business_trips_status', 'business_trips', ['status'], unique=False)
    op.create_table('organizational_services',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('department_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('coordinator_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('deputy_coordinator_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['coordinator_id'], ['users.id'], name='organizational_services_coordinator_id_fkey'),
    sa.ForeignKeyConstraint(['department_id'], ['departments.id'], name='organizational_services_department_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['deputy_coordinator_id'], ['users.id'], name='organizational_services_deputy_coordinator_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='organizational_services_pkey'),
    sa.UniqueConstraint('code', name='organizational_services_code_key')
    )
    op.create_table('work_schedules',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('monday_hours', sa.INTEGER(), server_default=sa.text('8'), autoincrement=False, nullable=False),
    sa.Column('tuesday_hours', sa.INTEGER(), server_default=sa.text('8'), autoincrement=False, nullable=False),
    sa.Column('wednesday_hours', sa.INTEGER(), server_default=sa.text('8'), autoincrement=False, nullable=False),
    sa.Column('thursday_hours', sa.INTEGER(), server_default=sa.text('8'), autoincrement=False, nullable=False),
    sa.Column('friday_hours', sa.INTEGER(), server_default=sa.text('8'), autoincrement=False, nullable=False),
    sa.Column('saturday_hours', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('sunday_hours', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='work_schedules_pkey'),
    sa.UniqueConstraint('code', name='work_schedules_code_key')
    )
    op.create_table('hr_alerts',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('alert_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('severity', sa.VARCHAR(length=20), server_default=sa.text("'info'::character varying"), autoincrement=False, nullable=True),
    sa.Column('employee_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('department_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('title', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('related_entity_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('related_entity_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('action_required', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('action_deadline', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=True),
    sa.Column('acknowledged_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('acknowledged_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('resolved_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('extra_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='hr_alerts_pkey')
    )
    op.create_index('ix_hr_reporting_hr_alerts_is_active', 'hr_alerts', ['is_active'], unique=False)
    op.create_index('ix_hr_reporting_hr_alerts_employee_id', 'hr_alerts', ['employee_id'], unique=False)
    op.create_index('ix_hr_reporting_hr_alerts_alert_type', 'hr_alerts', ['alert_type'], unique=False)
    op.create_index('ix_hr_alerts_active_severity', 'hr_alerts', ['is_active', 'severity', 'created_at'], unique=False)
    op.create_table('executive_levels',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('hierarchy_level', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('escalates_to_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('max_approval_amount', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=True),
    sa.Column('can_override_workflow', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['escalates_to_id'], ['executive_levels.id'], name='executive_levels_escalates_to_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='executive_levels_pkey'),
    sa.UniqueConstraint('code', name='executive_levels_code_key')
    )
    op.create_table('leave_requests',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('leave_type_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('leave_type_code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('start_half_day', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('end_half_day', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('days_requested', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False),
    sa.Column('hours_requested', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=True),
    sa.Column('employee_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('approver_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('approver_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('approved_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('has_conditions', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('condition_type', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('condition_details', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('condition_accepted', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('condition_accepted_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('cancelled_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('cancellation_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('recalled_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('recall_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('protocol_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('actual_return_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('compensation_days', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('deduction_details', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('policy_violations', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('balance_deducted', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('attachment_path', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('submitted_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('days_used_before_recall', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('recall_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('rejection_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('has_interruptions', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='leave_requests_pkey')
    )
    op.create_index('ix_leaves_leave_requests_user_id', 'leave_requests', ['user_id'], unique=False)
    op.create_index('ix_leaves_leave_requests_status', 'leave_requests', ['status'], unique=False)
    op.create_index('ix_leaves_leave_requests_start_date', 'leave_requests', ['start_date'], unique=False)
    op.create_table('wallet_transactions',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('wallet_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('reference_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('transaction_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('balance_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('balance_after', sa.NUMERIC(precision=7, scale=2), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('remaining_amount', sa.NUMERIC(precision=6, scale=2), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.Column('expiry_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('category', sa.VARCHAR(length=30), autoincrement=False, nullable=True),
    sa.Column('monetary_value', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=True),
    sa.Column('exchange_rate_to_hours', sa.NUMERIC(precision=10, scale=4), autoincrement=False, nullable=True),
    sa.Column('is_confirmed', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False),
    sa.Column('meta_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['wallet_id'], ['employee_wallets.id'], name='wallet_transactions_wallet_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='wallet_transactions_pkey')
    )
    op.create_table('roles',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('display_name', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('is_system', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('parent_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['parent_id'], ['roles.id'], name='fk_roles_parent_id', ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id', name='roles_pkey'),
    sa.UniqueConstraint('name', name='roles_name_key')
    )
    op.create_table('workflow_configs',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), autoincrement=False, nullable=False),
    sa.Column('entity_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('min_approvers', sa.INTEGER(), server_default=sa.text('1'), autoincrement=False, nullable=False),
    sa.Column('max_approvers', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('approval_mode', sa.VARCHAR(length=30), server_default=sa.text("'ANY'::character varying"), autoincrement=False, nullable=False),
    sa.Column('approver_role_ids', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'[]'::jsonb"), autoincrement=False, nullable=True),
    sa.Column('auto_assign_approvers', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('allow_self_approval', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('expiration_hours', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('expiration_action', sa.VARCHAR(length=30), server_default=sa.text("'REJECT'::character varying"), autoincrement=False, nullable=False),
    sa.Column('escalation_role_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('reminder_hours_before', sa.INTEGER(), server_default=sa.text('24'), autoincrement=False, nullable=True),
    sa.Column('send_reminders', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=True),
    sa.Column('conditions', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('priority', sa.INTEGER(), server_default=sa.text('100'), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=True),
    sa.Column('is_default', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('target_role_ids', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'[]'::jsonb"), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name='workflow_configs_pkey'),
    sa.UniqueConstraint('entity_type', 'name', name='uq_workflow_entity_name')
    )
    op.create_index('ix_approvals_workflow_configs_is_active', 'workflow_configs', ['is_active'], unique=False)
    op.create_index('ix_approvals_workflow_configs_entity_type', 'workflow_configs', ['entity_type'], unique=False)
    op.create_table('user_roles',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('role_name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('scope', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('granted_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('granted_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['auth.users.id'], name='user_roles_user_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='user_roles_pkey'),
    schema='auth'
    )
    op.create_index('ix_auth_user_roles_user_role', 'user_roles', ['user_id', 'role_name'], unique=False, schema='auth')
    op.create_table('expense_types',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('category', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('requires_receipt', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('max_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('km_reimbursement_rate', sa.NUMERIC(precision=5, scale=3), autoincrement=False, nullable=True),
    sa.Column('is_taxable', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('sort_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='expense_types_pkey'),
    sa.UniqueConstraint('code', name='expense_types_code_key')
    )
    op.create_table('time_ledger',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('year', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('entry_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('balance_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=False),
    sa.Column('reference_type', sa.VARCHAR(length=30), autoincrement=False, nullable=False),
    sa.Column('reference_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('reference_status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.CheckConstraint('amount >= 0::numeric', name='ck_time_ledger_amount_positive'),
    sa.PrimaryKeyConstraint('id', name='time_ledger_pkey')
    )
    op.create_index('ix_time_ledger_user_year_type', 'time_ledger', ['user_id', 'year', 'balance_type'], unique=False)
    op.create_index('ix_time_ledger_reference', 'time_ledger', ['reference_type', 'reference_id'], unique=False)
    op.create_index('ix_leaves_time_ledger_user_id', 'time_ledger', ['user_id'], unique=False)
    op.drop_index(op.f('ix_hr_reporting_monthly_timesheets_status'), table_name='monthly_timesheets', schema='hr_reporting')
    op.drop_index(op.f('ix_hr_reporting_monthly_timesheets_employee_id'), table_name='monthly_timesheets', schema='hr_reporting')
    op.drop_table('monthly_timesheets', schema='hr_reporting')
    op.drop_table('hr_reporting_settings', schema='hr_reporting')
    # ### end Alembic commands ###
